cscope 15 $HOME/cprogramming/ex40_dir -q 0000000418 0000079403
	@src/lcthw/BSTree.c

1 
	~<lùhw/BST»e.h
>

2 
	~<lùhw/dbg.h
>

3 
	~<¡dlib.h
>

4 
	~<lùhw/b¡¾ib.h
>

6 
	$deçuÉ_com·»
Ð*
a
 , *
b
)

8  
	`b¡rcmp
((
b¡ršg
)
a
 , (b¡ršg)
b
);

9 
	}
}

11 
BST»e
 *
	$BST»e_ü—‹
(
BST»e_com·»
 
com·»
)

13 
BST»e
 *
m­
 = 
	`ÿÎoc
(1, (BSTree));

14 
	`check_mem
(
m­
);

16 
m­
->
com·»
 = com·» =ð
NULL
 ? 
deçuÉ_com·»
 : compare;

18  
m­
;

20 
”rÜ
:

21 if(
m­
){

22 
	`BST»e_de¡roy
(
m­
);

24  
NULL
;

26 
	}
}

28 
	$BST»e_de¡roy_cb
(
BST»eNode
 *
node
)

30 
	`ä“
Ð
node
 );

32 
	}
}

34 
	$BST»e_de¡roy
(
BST»e
 *
m­
)

36 if(
m­
){

37 
	`BST»e_Œav”£
(
m­
 , 
BST»e_de¡roy_cb
);

38 
	`ä“
(
m­
);

40 
	}
}

42 
šlše
 
BST»eNode
 *
	$BST»eNode_ü—‹
(
BST»eNode
 *
·»Á
 ,*
key
 , *
d©a
)

44 
BST»eNode
 *
node
 = 
	`ÿÎoc
(1 , (BSTreeNode));

45 
	`check_mem
(
node
);

47 
node
->
key
 = key;

48 
node
->
d©a
 = data;

49 
node
->
·»Á
 =…arent;

50  
node
;

52 
”rÜ
:

53  
NULL
;

54 
	}
}

56 
šlše
 
	$BST»e_£Šode
(
BST»e
 *
m­
 , 
BST»eNode
 *
node
 , *
key
 , *
d©a
)

58 
cmp
 = 
m­
->
	`com·»
(
node
->
key
 , key);

60 if(
cmp
 <= 0){

61 ifÐ
node
->
Ëá
 ){

62 
	`BST»e_£Šode
(
m­
 , 
node
->
Ëá
 , 
key
 , 
d©a
);

64 
node
->
Ëá
 = 
	`BST»eNode_ü—‹
Òod, 
key
 , 
d©a
);

67 ifÐ
node
->
right
 ){

68 
	`BST»e_£Šode
(
m­
 , 
node
->
right
 , 
key
 , 
d©a
);

70 
node
->
right
 = 
	`BST»eNode_ü—‹
Òod, 
key
 , 
d©a
);

73 
	}
}

75 
	$BST»e_£t
(
BST»e
 *
m­
 , *
key
 , *
d©a
)

77 if(
m­
->
roÙ
 =ð
NULL
 ){

79 
m­
->
roÙ
 = 
	`BST»eNode_ü—‹
(
NULL
 , 
key
 , 
d©a
);

80 
	`check_mem
(
m­
->
roÙ
);

82 
	`BST»e_£Šode
(
m­
 , m­->
roÙ
 , 
key
 , 
d©a
);

85 
”rÜ
:

87 
	}
}

90 
šlše
 
BST»eNode
 *
	$BST»e_g‘node
(
BST»e
 *
m­
 , 
BST»eNode
* 
node
 , *
key
)

92 
cmp
 = 
m­
->
	`com·»
(
node
->
key
 , key);

94 if(
cmp
 == 0){

95  
node
;

96 } if(
cmp
 < 0){

97 if(
node
->
Ëá
) {

98  
	`BST»e_g‘node
(
m­
 ,
node
->
Ëá
 , 
key
);

100  
NULL
;

103 if(
node
->
right
){

104  
	`BST»e_g‘node
(
m­
 , 
node
->
right
 , 
key
);

106  
NULL
;

109 
	}
}

111 *
	$BST»e_g‘
(
BST»e
 *
m­
 , *
key
)

113 if(
m­
->
roÙ
 =ð
NULL
 )

114  
NULL
;

116 
BST»eNode
 *
node
 = 
	`BST»e_g‘node
(
m­
 , m­->
roÙ
 , 
key
);

117  
node
 =ð
NULL
 ? NULL :‚ode->
d©a
;

119 
	}
}

121 
šlše
 
	$BST»e_Œav”£_nodes
(
BST»eNode
 *
node
 , 
BST»e_Œav”£_cb
 
Œav”£_cb
)

123 
rc
 = 0;

125 if(
node
->
Ëá
){

126 
rc
 = 
	`BST»e_Œav”£_nodes
(
node
->
Ëá
 , 
Œav”£_cb
);

127 ifÐ
rc
 != 0 )„c;

130 if(
node
->
right
){

131 
rc
 = 
	`BST»e_Œav”£_nodes
(
node
->
right
 , 
Œav”£_cb
);

132 ifÐ
rc
 != 0)„c;

134  
	`Œav”£_cb
(
node
);

135 
	}
}

138 
	$BST»e_Œav”£
(
BST»e
 *
m­
 , 
BST»e_Œav”£_cb
 
Œav”£_cb
)

140 if(
m­
->
roÙ
) {

141  
	`BST»e_Œav”£_nodes
(
m­
->
roÙ
 , 
Œav”£_cb
);

144 
	}
}

146 
šlše
 
BST»eNode
 *
	$BST»e_fšd_mš
(
BST»eNode
 *
node
)

148 
node
->
Ëá
){

149 
node
 =‚ode->
Ëá
;

151  
node
;

152 
	}
}

154 
šlše
 
	$BST»e_»¶aû_node_š_·»Á
(
BST»e
 *
m­
 , 
BST»eNode
 *
node
 , BST»eNod*
Ãw_v®ue
)

156 if(
node
->
·»Á
){

157 if(
node
 =ðnode->
·»Á
->
Ëá
) {

158 
node
->
·»Á
->
Ëá
 = 
Ãw_v®ue
;

160 
node
->
·»Á
->
right
 = 
Ãw_v®ue
;

164 
m­
->
roÙ
 = 
Ãw_v®ue
;

167 if(
Ãw_v®ue
){

168 
Ãw_v®ue
->
·»Á
 = 
node
->parent;

170 
	}
}

172 
šlše
 
	$BST»e_sw­
(
BST»eNode
 *
a
 , BST»eNod*
b
)

174 *
‹mp
 = 
NULL
;

175 
‹mp
 = 
b
->
key
 ; b->key = 
a
->key;‡->key =emp;

176 
‹mp
 = 
b
->
d©a
 ; b->d©¨ð
a
->data ;‡->data =emp;

177 
	}
}

179 
šlše
 
BST»eNode
 *
	$BST»e_node_d–‘e
(
BST»e
 *
m­
 , 
BST»eNode
 *
node
 , *
key
)

181 
cmp
 = 
m­
->
	`com·»
(
node
->
key
 , key );

183 if(
cmp
 < 0 ){

184 if(
node
->
Ëá
 ) {

185  
	`BST»e_node_d–‘e
(
m­
 , 
node
->
Ëá
 , 
key
 );

188  
NULL
;

191 if(
cmp
 > 0 ){

192 if(
node
->
right
 ) {

193  
	`BST»e_node_d–‘e
(
m­
 , 
node
->
right
 , 
key
 );

196  
NULL
;

200 if(
node
->
Ëá
 &&‚ode->
right
) {

202 
BST»eNode
 *
sucûssÜ
 = 
	`BST»e_fšd_mš
(
node
->
right
);

203 
	`BST»e_sw­
(
sucûssÜ
 , 
node
);

207 
	`BST»e_»¶aû_node_š_·»Á
(
m­
 , 
sucûssÜ
 , sucûssÜ->
right
);

210  
sucûssÜ
;

211 } if(
node
->
Ëá
){

212 
	`BST»e_»¶aû_node_š_·»Á
(
m­
 , 
node
 ,‚ode->
Ëá
);

213 } if(
node
->
right
){

214 
	`BST»e_»¶aû_node_š_·»Á
(
m­
 , 
node
 ,‚ode->
right
);

216 
	`BST»e_»¶aû_node_š_·»Á
(
m­
 , 
node
 , 
NULL
 );

219  
node
;

222 
	}
}

224 *
	$BST»e_d–‘e
Ð
BST»e
 *
m­
 , *
key
)

226 *
d©a
 = 
NULL
;

228 if(
m­
->
roÙ
) {

229 
BST»eNode
 *
node
 = 
	`BST»e_node_d–‘e
(
m­
 , m­->
roÙ
 , 
key
);

231 if(
node
){

232 
d©a
 = 
node
->data;

233 
	`ä“
(
node
);

236  
d©a
;

237 
	}
}

	@src/lcthw/BSTree.h

1 #iâdeà
_lùhw_BST»e_h


2 
	#_lùhw_BST»e_h


	)

4 (*
	tBST»e_com·»
)(*
	ta
 , *
	tb
);

6 
	sBST»eNode
{

7 *
key
;

8 *
d©a
;

10 
BST»eNode
 *
Ëá
;

11 
BST»eNode
 *
right
;

12 
BST»eNode
 *
·»Á
;

13 }
	tBST»eNode
;

15 
	sBST»e
 {

16 
couÁ
;

17 
BST»e_com·»
 
com·»
;

18 
BST»eNode
 *
roÙ
;

19 } 
	tBST»e
;

21 (*
	tBST»e_Œav”£_cb
)(
	tBST»eNode
 *
	tnode
 );

23 
BST»e
 *
	`BST»e_ü—‹
(
BST»e_com·»
 
com·»
);

24 
	`BST»e_de¡roy
(
BST»e
 *
m­
);

26 
	`BST»e_£t
(
BST»e
 *
m­
 , *
key
 , *
d©a
);

27 * 
	`BST»e_g‘
(
BST»e
 *
m­
 , *
key
);

29 
	`BST»e_Œav”£
(
BST»e
 *
m­
 , 
BST»e_Œav”£_cb
 
Œav”£_cb
);

31 *
	`BST»e_d–‘e
(
BST»e
 *
m­
 , *
key
);

	@src/lcthw/bstrlib.c

14 #ià
defšed
 (
_MSC_VER
)

15 
	#_CRT_SECURE_NO_WARNINGS


	)

18 
	~<¡dio.h
>

19 
	~<¡ddef.h
>

20 
	~<¡d¬g.h
>

21 
	~<¡dlib.h
>

22 
	~<¡ršg.h
>

23 
	~<ùy³.h
>

24 
	~<lùhw/b¡¾ib.h
>

28 #ià
defšed
(
MEMORY_DEBUG
è|| defšed(
BSTRLIB_MEMORY_DEBUG
)

29 
	~"memdbg.h
"

32 #iâdeà
b¡r__®loc


33 
	#b¡r__®loc
(
x
è
	`m®loc
 (x)

	)

36 #iâdeà
b¡r__ä“


37 
	#b¡r__ä“
(
p
è
	`ä“
 (p)

	)

40 #iâdeà
b¡r__»®loc


41 
	#b¡r__»®loc
(
p
,
x
è
	`»®loc
 (Õ), (x))

	)

44 #iâdeà
b¡r__memýy


45 
	#b¡r__memýy
(
d
,
s
,
l
è
	`memýy
 ((d), (s), (l))

	)

48 #iâdeà
b¡r__memmove


49 
	#b¡r__memmove
(
d
,
s
,
l
è
	`memmove
 ((d), (s), (l))

	)

52 #iâdeà
b¡r__mem£t


53 
	#b¡r__mem£t
(
d
,
c
,
l
è
	`mem£t
 ((d), (c), (l))

	)

56 #iâdeà
b¡r__memcmp


57 
	#b¡r__memcmp
(
d
,
c
,
l
è
	`memcmp
 ((d), (c), (l))

	)

60 #iâdeà
b¡r__memchr


61 
	#b¡r__memchr
(
s
,
c
,
l
è
	`memchr
 ((s), (c), (l))

	)

66 
	#bBlockCÝy
(
D
,
S
,
L
è{ ià((Lè> 0è
	`b¡r__memmove
 ((D),(S),(L)); }

	)

70 
	$¢­UpSize
 (
i
) {

71 ià(
i
 < 8) {

72 
i
 = 8;

74 
j
;

75 
j
 = (è
i
;

77 
j
 |= (j >> 1);

78 
j
 |= (j >> 2);

79 
j
 |= (j >> 4);

80 
j
 |= (j >> 8);

81 #ià(
UINT_MAX
 != 0xffff)

82 
j
 |= (j >> 16);

83 #ià(
UINT_MAX
 > 0xffffffffUL)

84 
j
 |= (j >> 32);

88 
j
++;

89 ià((è
j
 >ð
i
) i = () j;

91  
i
;

92 
	}
}

98 
	$b®loc
 (
b¡ršg
 
b
, 
Þ’
) {

99 
Ën
;

100 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
¦’
 < 0 || b->
mËn
 <= 0 ||

101 
b
->
mËn
 < b->
¦’
 || 
Þ’
 <= 0) {

102  
BSTR_ERR
;

105 ià(
Þ’
 >ð
b
->
mËn
) {

106 * 
x
;

108 ià((
Ën
 = 
	`¢­UpSize
 (
Þ’
)è<ð
b
->
mËn
è 
BSTR_OK
;

111 ià(7 * 
b
->
mËn
 < 8 * b->
¦’
) {

116 
»®locSŒ©egy
:;

118 
x
 = (*è
	`b¡r__»®loc
 (
b
->
d©a
, (
size_t
è
Ën
);

119 ià(
x
 =ð
NULL
) {

124 ià(
NULL
 =ð(
x
 = (*è
	`b¡r__»®loc
 (
b
->
d©a
, (
size_t
è(
Ën
 = 
Þ’
)))) {

125  
BSTR_ERR
;

134 ià(
NULL
 =ð(
x
 = (*è
	`b¡r__®loc
 ((
size_t
è
Ën
))) {

139 
»®locSŒ©egy
;

142 ià(
b
->
¦’
è
	`b¡r__memýy
 ((*è
x
, (*èb->
d©a
, (
size_t
) b->slen);

143 
	`b¡r__ä“
 (
b
->
d©a
);

146 
b
->
d©a
 = 
x
;

147 
b
->
mËn
 = 
Ën
;

148 
b
->
d©a
[b->
¦’
] = () '\0';

151  
BSTR_OK
;

152 
	}
}

160 
	$b®locmš
 (
b¡ršg
 
b
, 
Ën
) {

161 * 
s
;

163 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || (b->
¦’
+1è< 0 || b->
mËn
 <= 0 ||

164 
b
->
mËn
 < b->
¦’
 || 
Ën
 <= 0) {

165  
BSTR_ERR
;

168 ià(
Ën
 < 
b
->
¦’
 + 1)†en = b->slen + 1;

170 ià(
Ën
 !ð
b
->
mËn
) {

171 
s
 = (*è
	`b¡r__»®loc
 (
b
->
d©a
, (
size_t
è
Ën
);

172 ià(
NULL
 =ð
s
è 
BSTR_ERR
;

173 
s
[
b
->
¦’
] = () '\0';

174 
b
->
d©a
 = 
s
;

175 
b
->
mËn
 = 
Ën
;

178  
BSTR_OK
;

179 
	}
}

186 
b¡ršg
 
	$bäomc¡r
 (cÚ¡ * 
¡r
) {

187 
b¡ršg
 
b
;

188 
i
;

189 
size_t
 
j
;

191 ià(
¡r
 =ð
NULL
)  NULL;

192 
j
 = (
¡¾’
è(
¡r
);

193 
i
 = 
	`¢­UpSize
 ((è(
j
 + (2 - (j != 0))));

194 ià(
i
 <ð(è
j
è 
NULL
;

196 
b
 = (
b¡ršg
è
	`b¡r__®loc
 ( (
gb¡ršg
));

197 ià(
NULL
 =ð
b
)  NULL;

198 
b
->
¦’
 = (è
j
;

199 ià(
NULL
 =ð(
b
->
d©a
 = (*è
	`b¡r__®loc
 (b->
mËn
 = 
i
))) {

200 
	`b¡r__ä“
 (
b
);

201  
NULL
;

204 
	`b¡r__memýy
 (
b
->
d©a
, 
¡r
, 
j
+1);

205  
b
;

206 
	}
}

214 
b¡ršg
 
	$bäomc¡¿Îoc
 (
mËn
, cÚ¡ * 
¡r
) {

215 
b¡ršg
 
b
;

216 
i
;

217 
size_t
 
j
;

219 ià(
¡r
 =ð
NULL
)  NULL;

220 
j
 = (
¡¾’
è(
¡r
);

221 
i
 = 
	`¢­UpSize
 ((è(
j
 + (2 - (j != 0))));

222 ià(
i
 <ð(è
j
è 
NULL
;

224 
b
 = (
b¡ršg
è
	`b¡r__®loc
 ( (
gb¡ršg
));

225 ià(
b
 =ð
NULL
)  NULL;

226 
b
->
¦’
 = (è
j
;

227 ià(
i
 < 
mËn
) i = mlen;

229 ià(
NULL
 =ð(
b
->
d©a
 = (*è
	`b¡r__®loc
 (b->
mËn
 = 
i
))) {

230 
	`b¡r__ä“
 (
b
);

231  
NULL
;

234 
	`b¡r__memýy
 (
b
->
d©a
, 
¡r
, 
j
+1);

235  
b
;

236 
	}
}

243 
b¡ršg
 
	$blk2b¡r
 (cÚ¡ * 
blk
, 
Ën
) {

244 
b¡ršg
 
b
;

245 
i
;

247 ià(
blk
 =ð
NULL
 || 
Ën
 < 0)  NULL;

248 
b
 = (
b¡ršg
è
	`b¡r__®loc
 ( (
gb¡ršg
));

249 ià(
b
 =ð
NULL
)  NULL;

250 
b
->
¦’
 = 
Ën
;

252 
i
 = 
Ën
 + (2 - (len != 0));

253 
i
 = 
	`¢­UpSize
 (i);

255 
b
->
mËn
 = 
i
;

257 
b
->
d©a
 = (*è
	`b¡r__®loc
 ((
size_t
èb->
mËn
);

258 ià(
b
->
d©a
 =ð
NULL
) {

259 
	`b¡r__ä“
 (
b
);

260  
NULL
;

263 ià(
Ën
 > 0è
	`b¡r__memýy
 (
b
->
d©a
, 
blk
, (
size_t
)†en);

264 
b
->
d©a
[
Ën
] = () '\0';

266  
b
;

267 
	}
}

276 * 
	$b¡r2c¡r
 (
cÚ¡_b¡ršg
 
b
, 
z
) {

277 
i
, 
l
;

278 * 
r
;

280 ià(
b
 =ð
NULL
 || b->
¦’
 < 0 || b->
d©a
 == NULL)  NULL;

281 
l
 = 
b
->
¦’
;

282 
r
 = (*è
	`b¡r__®loc
 ((
size_t
è(
l
 + 1));

283 ià(
r
 =ð
NULL
) „;

285 
i
=0; i < 
l
; i ++) {

286 
r
[
i
] = (è((
b
->
d©a
[i] =ð'\0'è? 
z
 : () (b->data[i]));

289 
r
[
l
] = () '\0';

291  
r
;

292 
	}
}

305 
	$bc¡rä“
 (* 
s
) {

306 ià(
s
) {

307 
	`b¡r__ä“
 (
s
);

308  
BSTR_OK
;

310  
BSTR_ERR
;

311 
	}
}

317 
	$bcÚÿt
 (
b¡ršg
 
b0
, 
cÚ¡_b¡ršg
 
b1
) {

318 
Ën
, 
d
;

319 
b¡ršg
 
aux
 = (b¡ršgè
b1
;

321 ià(
b0
 =ð
NULL
 || 
b1
 =ðNULL || b0->
d©a
 =ðNULL || b1->d©¨=ðNULLè 
BSTR_ERR
;

323 
d
 = 
b0
->
¦’
;

324 
Ën
 = 
b1
->
¦’
;

325 ià((
d
 | (
b0
->
mËn
 - dè| 
Ën
 | (d +†’)è< 0è 
BSTR_ERR
;

327 ià(
b0
->
mËn
 <ð
d
 + 
Ën
 + 1) {

328 
±rdiff_t
 
pd
 = 
b1
->
d©a
 - 
b0
->data;

329 ià(0 <ð
pd
 &&…d < 
b0
->
mËn
) {

330 ià(
NULL
 =ð(
aux
 = 
	`b¡rýy
 (
b1
))è 
BSTR_ERR
;

332 ià(
	`b®loc
 (
b0
, 
d
 + 
Ën
 + 1è!ð
BSTR_OK
) {

333 ià(
aux
 !ð
b1
è
	`bde¡roy
 (aux);

334  
BSTR_ERR
;

338 
	`bBlockCÝy
 (&
b0
->
d©a
[
d
], &
aux
->d©a[0], (
size_t
è
Ën
);

339 
b0
->
d©a
[
d
 + 
Ën
] = () '\0';

340 
b0
->
¦’
 = 
d
 + 
Ën
;

341 ià(
aux
 !ð
b1
è
	`bde¡roy
 (aux);

342  
BSTR_OK
;

343 
	}
}

349 
	$bcÚch¬
 (
b¡ršg
 
b
, 
c
) {

350 
d
;

352 ià(
b
 =ð
NULL
è 
BSTR_ERR
;

353 
d
 = 
b
->
¦’
;

354 ià((
d
 | (
b
->
mËn
 - d)è< 0 || 
	`b®loc
 (b, d + 2è!ð
BSTR_OK
è 
BSTR_ERR
;

355 
b
->
d©a
[
d
] = (è
c
;

356 
b
->
d©a
[
d
 + 1] = () '\0';

357 
b
->
¦’
++;

358  
BSTR_OK
;

359 
	}
}

365 
	$bÿtc¡r
 (
b¡ršg
 
b
, cÚ¡ * 
s
) {

366 * 
d
;

367 
i
, 
l
;

369 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
¦’
 < 0 || b->
mËn
 < b->slen

370 || 
b
->
mËn
 <ð0 || 
s
 =ð
NULL
è 
BSTR_ERR
;

373 
l
 = 
b
->
mËn
 - b->
¦’
;

374 
d
 = (*è&
b
->
d©a
[b->
¦’
];

375 
i
=0; i < 
l
; i++) {

376 ià((*
d
++ = *
s
++) == '\0') {

377 
b
->
¦’
 +ð
i
;

378  
BSTR_OK
;

381 
b
->
¦’
 +ð
i
;

384  
	`bÿtblk
 (
b
, (cÚ¡ *è
s
, (è
	`¡¾’
 (s));

385 
	}
}

391 
	$bÿtblk
 (
b¡ršg
 
b
, cÚ¡ * 
s
, 
Ën
) {

392 
Æ
;

394 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
¦’
 < 0 || b->
mËn
 < b->slen

395 || 
b
->
mËn
 <ð0 || 
s
 =ð
NULL
 || 
Ën
 < 0è 
BSTR_ERR
;

397 ià(0 > (
Æ
 = 
b
->
¦’
 + 
Ën
)è 
BSTR_ERR
;

398 ià(
b
->
mËn
 <ð
Æ
 && 0 > 
	`b®loc
 (b,‚È+ 1)è 
BSTR_ERR
;

400 
	`bBlockCÝy
 (&
b
->
d©a
[b->
¦’
], 
s
, (
size_t
è
Ën
);

401 
b
->
¦’
 = 
Æ
;

402 
b
->
d©a
[
Æ
] = () '\0';

403  
BSTR_OK
;

404 
	}
}

410 
b¡ršg
 
	$b¡rýy
 (
cÚ¡_b¡ršg
 
b
) {

411 
b¡ršg
 
b0
;

412 
i
,
j
;

415 ià(
b
 =ð
NULL
 || b->
¦’
 < 0 || b->
d©a
 == NULL)  NULL;

417 
b0
 = (
b¡ršg
è
	`b¡r__®loc
 ( (
gb¡ršg
));

418 ià(
b0
 =ð
NULL
) {

420  
NULL
;

423 
i
 = 
b
->
¦’
;

424 
j
 = 
	`¢­UpSize
 (
i
 + 1);

426 
b0
->
d©a
 = (*è
	`b¡r__®loc
 (
j
);

427 ià(
b0
->
d©a
 =ð
NULL
) {

428 
j
 = 
i
 + 1;

429 
b0
->
d©a
 = (*è
	`b¡r__®loc
 (
j
);

430 ià(
b0
->
d©a
 =ð
NULL
) {

432 
	`b¡r__ä“
 (
b0
);

433  
NULL
;

437 
b0
->
mËn
 = 
j
;

438 
b0
->
¦’
 = 
i
;

440 ià(
i
è
	`b¡r__memýy
 ((*è
b0
->
d©a
, (*è
b
->data, i);

441 
b0
->
d©a
[b0->
¦’
] = () '\0';

443  
b0
;

444 
	}
}

450 
	$bassign
 (
b¡ršg
 
a
, 
cÚ¡_b¡ršg
 
b
) {

451 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
¦’
 < 0)

452  
BSTR_ERR
;

453 ià(
b
->
¦’
 != 0) {

454 ià(
	`b®loc
 (
a
, 
b
->
¦’
è!ð
BSTR_OK
è 
BSTR_ERR
;

455 
	`b¡r__memmove
 (
a
->
d©a
, 
b
->d©a, b->
¦’
);

457 ià(
a
 =ð
NULL
 ||‡->
d©a
 =ðNULL ||‡->
mËn
 <‡->
¦’
 ||

458 
a
->
¦’
 < 0 ||‡->
mËn
 == 0)

459  
BSTR_ERR
;

461 
a
->
d©a
[
b
->
¦’
] = () '\0';

462 
a
->
¦’
 = 
b
->slen;

463  
BSTR_OK
;

464 
	}
}

472 
	$bassignmid¡r
 (
b¡ršg
 
a
, 
cÚ¡_b¡ršg
 
b
, 
Ëá
, 
Ën
) {

473 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
¦’
 < 0)

474  
BSTR_ERR
;

476 ià(
Ëá
 < 0) {

477 
Ën
 +ð
Ëá
;

478 
Ëá
 = 0;

481 ià(
Ën
 > 
b
->
¦’
 - 
Ëá
)†en = b->slen -†eft;

483 ià(
a
 =ð
NULL
 ||‡->
d©a
 =ðNULL ||‡->
mËn
 <‡->
¦’
 ||

484 
a
->
¦’
 < 0 ||‡->
mËn
 == 0)

485  
BSTR_ERR
;

487 ià(
Ën
 > 0) {

488 ià(
	`b®loc
 (
a
, 
Ën
è!ð
BSTR_OK
è 
BSTR_ERR
;

489 
	`b¡r__memmove
 (
a
->
d©a
, 
b
->d©¨+ 
Ëá
, 
Ën
);

490 
a
->
¦’
 = 
Ën
;

492 
a
->
¦’
 = 0;

494 
a
->
d©a
[a->
¦’
] = () '\0';

495  
BSTR_OK
;

496 
	}
}

504 
	$bassignc¡r
 (
b¡ršg
 
a
, cÚ¡ * 
¡r
) {

505 
i
;

506 
size_t
 
Ën
;

507 ià(
a
 =ð
NULL
 ||‡->
d©a
 =ðNULL ||‡->
mËn
 <‡->
¦’
 ||

508 
a
->
¦’
 < 0 ||‡->
mËn
 =ð0 || 
NULL
 =ð
¡r
)

509  
BSTR_ERR
;

511 
i
=0; i < 
a
->
mËn
; i++) {

512 ià('\0' =ð(
a
->
d©a
[
i
] = 
¡r
[i])) {

513 
a
->
¦’
 = 
i
;

514  
BSTR_OK
;

518 
a
->
¦’
 = 
i
;

519 
Ën
 = 
	`¡¾’
 (
¡r
 + 
i
);

520 ià(
Ën
 > 
INT_MAX
 || 
i
 +†en + 1 > INT_MAX ||

521 0 > 
	`b®loc
 (
a
, (è(
i
 + 
Ën
 + 1))è 
BSTR_ERR
;

522 
	`bBlockCÝy
 (
a
->
d©a
 + 
i
, 
¡r
 + i, (
size_t
è
Ën
 + 1);

523 
a
->
¦’
 +ð(è
Ën
;

524  
BSTR_OK
;

525 
	}
}

533 
	$bassignblk
 (
b¡ršg
 
a
, cÚ¡ * 
s
, 
Ën
) {

534 ià(
a
 =ð
NULL
 ||‡->
d©a
 =ðNULL ||‡->
mËn
 <‡->
¦’
 ||

535 
a
->
¦’
 < 0 ||‡->
mËn
 =ð0 || 
NULL
 =ð
s
 || 
Ën
 + 1 < 1)

536  
BSTR_ERR
;

537 ià(
Ën
 + 1 > 
a
->
mËn
 && 0 > 
	`b®loc
 (a,†’ + 1)è 
BSTR_ERR
;

538 
	`bBlockCÝy
 (
a
->
d©a
, 
s
, (
size_t
è
Ën
);

539 
a
->
d©a
[
Ën
] = () '\0';

540 
a
->
¦’
 = 
Ën
;

541  
BSTR_OK
;

542 
	}
}

548 
	$bŒunc
 (
b¡ršg
 
b
, 
n
) {

549 ià(
n
 < 0 || 
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
mËn
 < b->
¦’
 ||

550 
b
->
¦’
 < 0 || b->
mËn
 <ð0è 
BSTR_ERR
;

551 ià(
b
->
¦’
 > 
n
) {

552 
b
->
¦’
 = 
n
;

553 
b
->
d©a
[
n
] = () '\0';

555  
BSTR_OK
;

556 
	}
}

558 
	#upÿ£
(
c
è(
	`touµ”
 ((èc))

	)

559 
	#downÿ£
(
c
è(
	`tÞow”
 ((èc))

	)

560 
	#w¥aû
(
c
è(
	`is¥aû
 ((èc))

	)

566 
	$btouµ”
 (
b¡ršg
 
b
) {

567 
i
, 
Ën
;

568 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
mËn
 < b->
¦’
 ||

569 
b
->
¦’
 < 0 || b->
mËn
 <ð0è 
BSTR_ERR
;

570 
i
=0, 
Ën
 = 
b
->
¦’
; i <†en; i++) {

571 
b
->
d©a
[
i
] = (è
	`upÿ£
 (b->data[i]);

573  
BSTR_OK
;

574 
	}
}

580 
	$btÞow”
 (
b¡ršg
 
b
) {

581 
i
, 
Ën
;

582 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
mËn
 < b->
¦’
 ||

583 
b
->
¦’
 < 0 || b->
mËn
 <ð0è 
BSTR_ERR
;

584 
i
=0, 
Ën
 = 
b
->
¦’
; i <†en; i++) {

585 
b
->
d©a
[
i
] = (è
	`downÿ£
 (b->data[i]);

587  
BSTR_OK
;

588 
	}
}

599 
	$b¡ricmp
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡_b¡ršg 
b1
) {

600 
i
, 
v
, 
n
;

602 ià(
	`bd©a
 (
b0
è=ð
NULL
 || b0->
¦’
 < 0 ||

603 
	`bd©a
 (
b1
è=ð
NULL
 || b1->
¦’
 < 0è 
SHRT_MIN
;

604 ià((
n
 = 
b0
->
¦’
è> 
b1
->slen)‚ = b1->slen;

605 ià(
b0
->
¦’
 =ð
b1
->¦’ && b0->
d©a
 =ðb1->d©aè 
BSTR_OK
;

607 
i
 = 0; i < 
n
; i ++) {

608 
v
 = (è
	`downÿ£
 (
b0
->
d©a
[
i
])

609 - (è
	`downÿ£
 (
b1
->
d©a
[
i
]);

610 ià(0 !ð
v
)  v;

613 ià(
b0
->
¦’
 > 
n
) {

614 
v
 = (è
	`downÿ£
 (
b0
->
d©a
[
n
]);

615 ià(
v
)  v;

616  
UCHAR_MAX
 + 1;

618 ià(
b1
->
¦’
 > 
n
) {

619 
v
 = - (è
	`downÿ£
 (
b1
->
d©a
[
n
]);

620 ià(
v
)  v;

621  - (è(
UCHAR_MAX
 + 1);

623  
BSTR_OK
;

624 
	}
}

636 
	$b¡ºicmp
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡_b¡ršg 
b1
, 
n
) {

637 
i
, 
v
, 
m
;

639 ià(
	`bd©a
 (
b0
è=ð
NULL
 || b0->
¦’
 < 0 ||

640 
	`bd©a
 (
b1
è=ð
NULL
 || b1->
¦’
 < 0 || 
n
 < 0è 
SHRT_MIN
;

641 
m
 = 
n
;

642 ià(
m
 > 
b0
->
¦’
) m = b0->slen;

643 ià(
m
 > 
b1
->
¦’
) m = b1->slen;

645 ià(
b0
->
d©a
 !ð
b1
->data) {

646 
i
 = 0; i < 
m
; i ++) {

647 
v
 = (è
	`downÿ£
 (
b0
->
d©a
[
i
]);

648 
v
 -ð(è
	`downÿ£
 (
b1
->
d©a
[
i
]);

649 ià(
v
 !ð0è 
b0
->
d©a
[
i
] - 
b1
->data[i];

653 ià(
n
 =ð
m
 || 
b0
->
¦’
 =ð
b1
->¦’è 
BSTR_OK
;

655 ià(
b0
->
¦’
 > 
m
) {

656 
v
 = (è
	`downÿ£
 (
b0
->
d©a
[
m
]);

657 ià(
v
)  v;

658  
UCHAR_MAX
 + 1;

661 
v
 = - (è
	`downÿ£
 (
b1
->
d©a
[
m
]);

662 ià(
v
)  v;

663  - (è(
UCHAR_MAX
 + 1);

664 
	}
}

674 
	$bi£qÿ£Ëss
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡_b¡ršg 
b1
) {

675 
i
, 
n
;

677 ià(
	`bd©a
 (
b0
è=ð
NULL
 || b0->
¦’
 < 0 ||

678 
	`bd©a
 (
b1
è=ð
NULL
 || b1->
¦’
 < 0è 
BSTR_ERR
;

679 ià(
b0
->
¦’
 !ð
b1
->¦’è 
BSTR_OK
;

680 ià(
b0
->
d©a
 =ð
b1
->d©¨|| b0->
¦’
 == 0)  1;

681 
i
=0, 
n
=
b0
->
¦’
; i <‚; i++) {

682 ià(
b0
->
d©a
[
i
] !ð
b1
->data[i]) {

683 
c
 = (è
	`downÿ£
 (
b0
->
d©a
[
i
]);

684 ià(
c
 !ð(è
	`downÿ£
 (
b1
->
d©a
[
i
]))  0;

688 
	}
}

699 
	$bis¡emeqÿ£Ëssblk
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡ * 
blk
, 
Ën
) {

700 
i
;

702 ià(
	`bd©a
 (
b0
è=ð
NULL
 || b0->
¦’
 < 0 || NULL =ð
blk
 || 
Ën
 < 0)

703  
BSTR_ERR
;

704 ià(
b0
->
¦’
 < 
Ën
è 
BSTR_OK
;

705 ià(
b0
->
d©a
 =ð(cÚ¡ *è
blk
 || 
Ën
 == 0)  1;

707 
i
 = 0; i < 
Ën
; i ++) {

708 ià(
b0
->
d©a
[
i
] !ð((cÚ¡ *è
blk
)[i]) {

709 ià(
	`downÿ£
 (
b0
->
d©a
[
i
]) !=

710 
	`downÿ£
 (((cÚ¡ *è
blk
)[
i
]))  0;

714 
	}
}

721 
	$bÉrimws
 (
b¡ršg
 
b
) {

722 
i
, 
Ën
;

724 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
mËn
 < b->
¦’
 ||

725 
b
->
¦’
 < 0 || b->
mËn
 <ð0è 
BSTR_ERR
;

727 
Ën
 = 
b
->
¦’
, 
i
 = 0; i <†en; i++) {

728 ià(!
	`w¥aû
 (
b
->
d©a
[
i
])) {

729  
	`bd–‘e
 (
b
, 0, 
i
);

733 
b
->
d©a
[0] = () '\0';

734 
b
->
¦’
 = 0;

735  
BSTR_OK
;

736 
	}
}

743 
	$b¹rimws
 (
b¡ršg
 
b
) {

744 
i
;

746 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
mËn
 < b->
¦’
 ||

747 
b
->
¦’
 < 0 || b->
mËn
 <ð0è 
BSTR_ERR
;

749 
i
 = 
b
->
¦’
 - 1; i >= 0; i--) {

750 ià(!
	`w¥aû
 (
b
->
d©a
[
i
])) {

751 ià(
b
->
mËn
 > 
i
èb->
d©a
[i+1] = () '\0';

752 
b
->
¦’
 = 
i
 + 1;

753  
BSTR_OK
;

757 
b
->
d©a
[0] = () '\0';

758 
b
->
¦’
 = 0;

759  
BSTR_OK
;

760 
	}
}

767 
	$bŒimws
 (
b¡ršg
 
b
) {

768 
i
, 
j
;

770 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
mËn
 < b->
¦’
 ||

771 
b
->
¦’
 < 0 || b->
mËn
 <ð0è 
BSTR_ERR
;

773 
i
 = 
b
->
¦’
 - 1; i >= 0; i--) {

774 ià(!
	`w¥aû
 (
b
->
d©a
[
i
])) {

775 ià(
b
->
mËn
 > 
i
èb->
d©a
[i+1] = () '\0';

776 
b
->
¦’
 = 
i
 + 1;

777 
j
 = 0; 
	`w¥aû
 (
b
->
d©a
[j]); j++) {}

778  
	`bd–‘e
 (
b
, 0, 
j
);

782 
b
->
d©a
[0] = () '\0';

783 
b
->
¦’
 = 0;

784  
BSTR_OK
;

785 
	}
}

794 
	$bi£q
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡_b¡ršg 
b1
) {

795 ià(
b0
 =ð
NULL
 || 
b1
 =ðNULL || b0->
d©a
 == NULL || b1->data == NULL ||

796 
b0
->
¦’
 < 0 || 
b1
->¦’ < 0è 
BSTR_ERR
;

797 ià(
b0
->
¦’
 !ð
b1
->¦’è 
BSTR_OK
;

798 ià(
b0
->
d©a
 =ð
b1
->d©¨|| b0->
¦’
 == 0)  1;

799  !
	`b¡r__memcmp
 (
b0
->
d©a
, 
b1
->d©a, b0->
¦’
);

800 
	}
}

810 
	$bis¡emeqblk
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡ * 
blk
, 
Ën
) {

811 
i
;

813 ià(
	`bd©a
 (
b0
è=ð
NULL
 || b0->
¦’
 < 0 || NULL =ð
blk
 || 
Ën
 < 0)

814  
BSTR_ERR
;

815 ià(
b0
->
¦’
 < 
Ën
è 
BSTR_OK
;

816 ià(
b0
->
d©a
 =ð(cÚ¡ *è
blk
 || 
Ën
 == 0)  1;

818 
i
 = 0; i < 
Ën
; i ++) {

819 ià(
b0
->
d©a
[
i
] !ð((cÚ¡ *è
blk
)[i]è 
BSTR_OK
;

822 
	}
}

835 
	$bi£qc¡r
 (
cÚ¡_b¡ršg
 
b
, cÚ¡ * 
s
) {

836 
i
;

837 ià(
b
 =ð
NULL
 || 
s
 =ðNULL || b->
d©a
 =ðNULL || b->
¦’
 < 0è 
BSTR_ERR
;

838 
i
=0; i < 
b
->
¦’
; i++) {

839 ià(
s
[
i
] =ð'\0' || 
b
->
d©a
[i] !ð(ès[i]è 
BSTR_OK
;

841  
s
[
i
] == '\0';

842 
	}
}

856 
	$bi£qc¡rÿ£Ëss
 (
cÚ¡_b¡ršg
 
b
, cÚ¡ * 
s
) {

857 
i
;

858 ià(
b
 =ð
NULL
 || 
s
 =ðNULL || b->
d©a
 =ðNULL || b->
¦’
 < 0è 
BSTR_ERR
;

859 
i
=0; i < 
b
->
¦’
; i++) {

860 ià(
s
[
i
] == '\0' ||

861 (
b
->
d©a
[
i
] !ð(è
s
[i] &&

862 
	`downÿ£
 (
b
->
d©a
[
i
]è!ð(èdownÿ£ (
s
[i])))

863  
BSTR_OK
;

865  
s
[
i
] == '\0';

866 
	}
}

882 
	$b¡rcmp
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡_b¡ršg 
b1
) {

883 
i
, 
v
, 
n
;

885 ià(
b0
 =ð
NULL
 || 
b1
 =ðNULL || b0->
d©a
 == NULL || b1->data == NULL ||

886 
b0
->
¦’
 < 0 || 
b1
->¦’ < 0è 
SHRT_MIN
;

887 
n
 = 
b0
->
¦’
; iàÒ > 
b1
->slen)‚ = b1->slen;

888 ià(
b0
->
¦’
 =ð
b1
->¦’ && (b0->
d©a
 == b1->data || b0->slen == 0))

889  
BSTR_OK
;

891 
i
 = 0; i < 
n
; i ++) {

892 
v
 = ((è
b0
->
d©a
[
i
]è- ((è
b1
->data[i]);

893 ià(
v
 != 0)  v;

894 ià(
b0
->
d©a
[
i
] =ð(è'\0'è 
BSTR_OK
;

897 ià(
b0
->
¦’
 > 
n
)  1;

898 ià(
b1
->
¦’
 > 
n
)  -1;

899  
BSTR_OK
;

900 
	}
}

912 
	$b¡ºcmp
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡_b¡ršg 
b1
, 
n
) {

913 
i
, 
v
, 
m
;

915 ià(
b0
 =ð
NULL
 || 
b1
 =ðNULL || b0->
d©a
 == NULL || b1->data == NULL ||

916 
b0
->
¦’
 < 0 || 
b1
->¦’ < 0è 
SHRT_MIN
;

917 
m
 = 
n
;

918 ià(
m
 > 
b0
->
¦’
) m = b0->slen;

919 ià(
m
 > 
b1
->
¦’
) m = b1->slen;

921 ià(
b0
->
d©a
 !ð
b1
->data) {

922 
i
 = 0; i < 
m
; i ++) {

923 
v
 = ((è
b0
->
d©a
[
i
]è- ((è
b1
->data[i]);

924 ià(
v
 != 0)  v;

925 ià(
b0
->
d©a
[
i
] =ð(è'\0'è 
BSTR_OK
;

929 ià(
n
 =ð
m
 || 
b0
->
¦’
 =ð
b1
->¦’è 
BSTR_OK
;

931 ià(
b0
->
¦’
 > 
m
)  1;

933 
	}
}

942 
b¡ršg
 
	$bmid¡r
 (
cÚ¡_b¡ršg
 
b
, 
Ëá
, 
Ën
) {

944 ià(
b
 =ð
NULL
 || b->
¦’
 < 0 || b->
d©a
 == NULL)  NULL;

946 ià(
Ëá
 < 0) {

947 
Ën
 +ð
Ëá
;

948 
Ëá
 = 0;

951 ià(
Ën
 > 
b
->
¦’
 - 
Ëá
)†en = b->slen -†eft;

953 ià(
Ën
 <ð0è 
	`bäomc¡r
 ("");

954  
	`blk2b¡r
 (
b
->
d©a
 + 
Ëá
, 
Ën
);

955 
	}
}

964 
	$bd–‘e
 (
b¡ršg
 
b
, 
pos
, 
Ën
) {

966 ià(
pos
 < 0) {

967 
Ën
 +ð
pos
;

968 
pos
 = 0;

971 ià(
Ën
 < 0 || 
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
¦’
 < 0 ||

972 
b
->
mËn
 < b->
¦’
 || b->mlen <= 0)

973  
BSTR_ERR
;

974 ià(
Ën
 > 0 && 
pos
 < 
b
->
¦’
) {

975 ià(
pos
 + 
Ën
 >ð
b
->
¦’
) {

976 
b
->
¦’
 = 
pos
;

978 
	`bBlockCÝy
 ((*è(
b
->
d©a
 + 
pos
),

979 (*è(
b
->
d©a
 + 
pos
 + 
Ën
),

980 
b
->
¦’
 - (
pos
+
Ën
));

981 
b
->
¦’
 -ð
Ën
;

983 
b
->
d©a
[b->
¦’
] = () '\0';

985  
BSTR_OK
;

986 
	}
}

995 
	$bde¡roy
 (
b¡ršg
 
b
) {

996 ià(
b
 =ð
NULL
 || b->
¦’
 < 0 || b->
mËn
 <= 0 || b->mlen < b->slen ||

997 
b
->
d©a
 =ð
NULL
)

998  
BSTR_ERR
;

1000 
	`b¡r__ä“
 (
b
->
d©a
);

1005 
b
->
¦’
 = -1;

1006 
b
->
mËn
 = -
__LINE__
;

1007 
b
->
d©a
 = 
NULL
;

1009 
	`b¡r__ä“
 (
b
);

1010  
BSTR_OK
;

1011 
	}
}

1022 
	$bš¡r
 (
cÚ¡_b¡ršg
 
b1
, 
pos
, cÚ¡_b¡ršg 
b2
) {

1023 
j
, 
ii
, 
Î
, 
lf
;

1024 * 
d0
;

1025 
c0
;

1026 * 
d1
;

1027 
c1
;

1028 
i
;

1030 ià(
b1
 =ð
NULL
 || b1->
d©a
 =ðNULL || b1->
¦’
 < 0 ||

1031 
b2
 =ð
NULL
 || b2->
d©a
 =ðNULL || b2->
¦’
 < 0è 
BSTR_ERR
;

1032 ià(
b1
->
¦’
 =ð
pos
è (
b2
->¦’ =ð0)?pos:
BSTR_ERR
;

1033 ià(
b1
->
¦’
 < 
pos
 ||…o < 0è 
BSTR_ERR
;

1034 ià(
b2
->
¦’
 =ð0è 
pos
;

1037 ià((
lf
 = 
b1
->
¦’
 - 
b2
->¦’ + 1è<ð
pos
è 
BSTR_ERR
;

1040 ià(
b1
->
d©a
 =ð
b2
->d©¨&& 
pos
 == 0)  0;

1042 
i
 = 
pos
;

1044 
d0
 = 
b2
->
d©a
;

1045 
d1
 = 
b1
->
d©a
;

1046 
Î
 = 
b2
->
¦’
;

1049 
c0
 = 
d0
[0];

1050 ià(1 =ð
Î
) {

1051 ;
i
 < 
lf
; i++èià(
c0
 =ð
d1
[i])  i;

1052  
BSTR_ERR
;

1055 
c1
 = 
c0
;

1056 
j
 = 0;

1057 
lf
 = 
b1
->
¦’
 - 1;

1059 
ii
 = -1;

1060 ià(
i
 < 
lf
) do {

1062 ià(
c1
 !ð
d1
[
i
]) {

1063 ià(
c1
 !ð
d1
[1+
i
]) {

1064 
i
 += 2;

1067 
i
++;

1071 ià(0 =ð
j
è
ii
 = 
i
;

1074 
j
++;

1075 
i
++;

1078 ià(
j
 < 
Î
) {

1079 
c1
 = 
d0
[
j
];

1083 
N0
:;

1086 ià(
i
 =ð
ii
+
j
)  ii;

1089 
i
 -ð
j
;

1090 
j
 = 0;

1091 
c1
 = 
c0
;

1092 } 
i
 < 
lf
);

1095 ià(
i
 =ð
lf
 && 
Î
 =ð
j
+1 && 
c1
 =ð
d1
[i]è
N0
;

1097  
BSTR_ERR
;

1098 
	}
}

1109 
	$bš¡¼
 (
cÚ¡_b¡ršg
 
b1
, 
pos
, cÚ¡_b¡ršg 
b2
) {

1110 
j
, 
i
, 
l
;

1111 * 
d0
, * 
d1
;

1113 ià(
b1
 =ð
NULL
 || b1->
d©a
 =ðNULL || b1->
¦’
 < 0 ||

1114 
b2
 =ð
NULL
 || b2->
d©a
 =ðNULL || b2->
¦’
 < 0è 
BSTR_ERR
;

1115 ià(
b1
->
¦’
 =ð
pos
 && 
b2
->slen == 0) …os;

1116 ià(
b1
->
¦’
 < 
pos
 ||…o < 0è 
BSTR_ERR
;

1117 ià(
b2
->
¦’
 =ð0è 
pos
;

1120 ià(
b1
->
d©a
 =ð
b2
->d©¨&& 
pos
 =ð0 && b2->
¦’
 <= b1->slen)  0;

1122 
i
 = 
pos
;

1123 ià((
l
 = 
b1
->
¦’
 - 
b2
->¦’è< 0è 
BSTR_ERR
;

1126 ià(
l
 + 1 <ð
i
) i =†;

1127 
j
 = 0;

1129 
d0
 = 
b2
->
d©a
;

1130 
d1
 = 
b1
->
d©a
;

1131 
l
 = 
b2
->
¦’
;

1134 ià(
d0
[
j
] =ð
d1
[
i
 + j]) {

1135 
j
 ++;

1136 ià(
j
 >ð
l
è 
i
;

1138 
i
 --;

1139 ià(
i
 < 0) ;

1140 
j
=0;

1144  
BSTR_ERR
;

1145 
	}
}

1156 
	$bš¡rÿ£Ëss
 (
cÚ¡_b¡ršg
 
b1
, 
pos
, cÚ¡_b¡ršg 
b2
) {

1157 
j
, 
i
, 
l
, 
Î
;

1158 * 
d0
, * 
d1
;

1160 ià(
b1
 =ð
NULL
 || b1->
d©a
 =ðNULL || b1->
¦’
 < 0 ||

1161 
b2
 =ð
NULL
 || b2->
d©a
 =ðNULL || b2->
¦’
 < 0è 
BSTR_ERR
;

1162 ià(
b1
->
¦’
 =ð
pos
è (
b2
->¦’ =ð0)?pos:
BSTR_ERR
;

1163 ià(
b1
->
¦’
 < 
pos
 ||…o < 0è 
BSTR_ERR
;

1164 ià(
b2
->
¦’
 =ð0è 
pos
;

1166 
l
 = 
b1
->
¦’
 - 
b2
->slen + 1;

1169 ià(
l
 <ð
pos
è 
BSTR_ERR
;

1172 ià(
b1
->
d©a
 =ð
b2
->d©¨&& 
pos
 =ð0è 
BSTR_OK
;

1174 
i
 = 
pos
;

1175 
j
 = 0;

1177 
d0
 = 
b2
->
d©a
;

1178 
d1
 = 
b1
->
d©a
;

1179 
Î
 = 
b2
->
¦’
;

1182 ià(
d0
[
j
] =ð
d1
[
i
 + j] || 
	`downÿ£
 (d0[j]) == downcase (d1[i + j])) {

1183 
j
 ++;

1184 ià(
j
 >ð
Î
è 
i
;

1186 
i
 ++;

1187 ià(
i
 >ð
l
) ;

1188 
j
=0;

1192  
BSTR_ERR
;

1193 
	}
}

1204 
	$bš¡¼ÿ£Ëss
 (
cÚ¡_b¡ršg
 
b1
, 
pos
, cÚ¡_b¡ršg 
b2
) {

1205 
j
, 
i
, 
l
;

1206 * 
d0
, * 
d1
;

1208 ià(
b1
 =ð
NULL
 || b1->
d©a
 =ðNULL || b1->
¦’
 < 0 ||

1209 
b2
 =ð
NULL
 || b2->
d©a
 =ðNULL || b2->
¦’
 < 0è 
BSTR_ERR
;

1210 ià(
b1
->
¦’
 =ð
pos
 && 
b2
->slen == 0) …os;

1211 ià(
b1
->
¦’
 < 
pos
 ||…o < 0è 
BSTR_ERR
;

1212 ià(
b2
->
¦’
 =ð0è 
pos
;

1215 ià(
b1
->
d©a
 =ð
b2
->d©¨&& 
pos
 =ð0 && b2->
¦’
 <ðb1->¦’è 
BSTR_OK
;

1217 
i
 = 
pos
;

1218 ià((
l
 = 
b1
->
¦’
 - 
b2
->¦’è< 0è 
BSTR_ERR
;

1221 ià(
l
 + 1 <ð
i
) i =†;

1222 
j
 = 0;

1224 
d0
 = 
b2
->
d©a
;

1225 
d1
 = 
b1
->
d©a
;

1226 
l
 = 
b2
->
¦’
;

1229 ià(
d0
[
j
] =ð
d1
[
i
 + j] || 
	`downÿ£
 (d0[j]) == downcase (d1[i + j])) {

1230 
j
 ++;

1231 ià(
j
 >ð
l
è 
i
;

1233 
i
 --;

1234 ià(
i
 < 0) ;

1235 
j
=0;

1239  
BSTR_ERR
;

1240 
	}
}

1248 
	$b¡rch½
 (
cÚ¡_b¡ršg
 
b
, 
c
, 
pos
) {

1249 * 
p
;

1251 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
¦’
 <ð
pos
 ||…o < 0è 
BSTR_ERR
;

1252 
p
 = (*è
	`b¡r__memchr
 ((
b
->
d©a
 + 
pos
), (è
c
, (b->
¦’
 -…os));

1253 ià(
p
è (èÕ - 
b
->
d©a
);

1254  
BSTR_ERR
;

1255 
	}
}

1262 
	$b¡¼ch½
 (
cÚ¡_b¡ršg
 
b
, 
c
, 
pos
) {

1263 
i
;

1265 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
¦’
 <ð
pos
 ||…o < 0è 
BSTR_ERR
;

1266 
i
=
pos
; i >= 0; i--) {

1267 ià(
b
->
d©a
[
i
] =ð(è
c
)  i;

1269  
BSTR_ERR
;

1270 
	}
}

1272 #ià!
defšed
 (
BSTRLIB_AGGRESSIVE_MEMORY_FOR_SPEED_TRADEOFF
)

1273 
	#LONG_LOG_BITS_QTY
 (3)

	)

1274 
	#LONG_BITS_QTY
 (1 << 
LONG_LOG_BITS_QTY
)

	)

1275 
	#LONG_TYPE
 

	)

1277 
	#CFCLEN
 ((1 << 
CHAR_BIT
è/ 
LONG_BITS_QTY
)

	)

1278 
	sch¬F›ld
 { 
LONG_TYPE
 
	mcÚ‹Á
[
CFCLEN
]; };

1279 
	#‹¡InCh¬F›ld
(
cf
,
c
è((cf)->
cÚ‹Á
[(cè>> 
LONG_LOG_BITS_QTY
] & ((()1è<< ((cè& (
LONG_BITS_QTY
-1))))

	)

1280 
	#£tInCh¬F›ld
(
cf
,
idx
) { \

1281 
c
 = (è(
idx
); \

1282 (
cf
)->
cÚ‹Á
[
c
 >> 
LONG_LOG_BITS_QTY
] |ð(
LONG_TYPE
è(1uÈ<< (ø& (
LONG_BITS_QTY
-1))); \

1283 }

	)

1287 
	#CFCLEN
 (1 << 
CHAR_BIT
)

	)

1288 
	sch¬F›ld
 { 
	mcÚ‹Á
[
CFCLEN
]; };

1289 
	#‹¡InCh¬F›ld
(
cf
,
c
è((cf)->
cÚ‹Á
[(è(c)])

	)

1290 
	#£tInCh¬F›ld
(
cf
,
idx
è(cf)->
cÚ‹Á
[(è(idx)] = ~0

	)

1295 
	$buždCh¬F›ld
 (
ch¬F›ld
 * 
cf
, 
cÚ¡_b¡ršg
 
b
) {

1296 
i
;

1297 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || b->
¦’
 <ð0è 
BSTR_ERR
;

1298 
	`mem£t
 ((*è
cf
->
cÚ‹Á
, 0,  (
ch¬F›ld
));

1299 
i
=0; i < 
b
->
¦’
; i++) {

1300 
	`£tInCh¬F›ld
 (
cf
, 
b
->
d©a
[
i
]);

1302  
BSTR_OK
;

1303 
	}
}

1305 
	$šv”tCh¬F›ld
 (
ch¬F›ld
 * 
cf
) {

1306 
i
;

1307 
i
=0; i < 
CFCLEN
; i++è
cf
->
cÚ‹Á
[i] = ~cf->content[i];

1308 
	}
}

1311 
	$bšchrCF
 (cÚ¡ * 
d©a
, 
Ën
, 
pos
, cÚ¡ 
ch¬F›ld
 * 
cf
) {

1312 
i
;

1313 
i
=
pos
; i < 
Ën
; i++) {

1314 
c
 = (è
d©a
[
i
];

1315 ià(
	`‹¡InCh¬F›ld
 (
cf
, 
c
)è 
i
;

1317  
BSTR_ERR
;

1318 
	}
}

1326 
	$bšchr
 (
cÚ¡_b¡ršg
 
b0
, 
pos
, cÚ¡_b¡ršg 
b1
) {

1327 
ch¬F›ld
 
chrs
;

1328 ià(
pos
 < 0 || 
b0
 =ð
NULL
 || b0->
d©a
 == NULL ||

1329 
b0
->
¦’
 <ð
pos
è 
BSTR_ERR
;

1330 ià(1 =ð
b1
->
¦’
è 
	`b¡rch½
 (
b0
, b1->
d©a
[0], 
pos
);

1331 ià(0 > 
	`buždCh¬F›ld
 (&
chrs
, 
b1
)è 
BSTR_ERR
;

1332  
	`bšchrCF
 (
b0
->
d©a
, b0->
¦’
, 
pos
, &
chrs
);

1333 
	}
}

1336 
	$bšch¼CF
 (cÚ¡ * 
d©a
, 
pos
, cÚ¡ 
ch¬F›ld
 * 
cf
) {

1337 
i
;

1338 
i
=
pos
; i >= 0; i--) {

1339 
c
 = (è
d©a
[
i
];

1340 ià(
	`‹¡InCh¬F›ld
 (
cf
, 
c
)è 
i
;

1342  
BSTR_ERR
;

1343 
	}
}

1351 
	$bšch¼
 (
cÚ¡_b¡ršg
 
b0
, 
pos
, cÚ¡_b¡ršg 
b1
) {

1352 
ch¬F›ld
 
chrs
;

1353 ià(
pos
 < 0 || 
b0
 =ð
NULL
 || b0->
d©a
 =ðNULL || 
b1
 == NULL ||

1354 
b0
->
¦’
 < 
pos
è 
BSTR_ERR
;

1355 ià(
pos
 =ð
b0
->
¦’
)…os--;

1356 ià(1 =ð
b1
->
¦’
è 
	`b¡¼ch½
 (
b0
, b1->
d©a
[0], 
pos
);

1357 ià(0 > 
	`buždCh¬F›ld
 (&
chrs
, 
b1
)è 
BSTR_ERR
;

1358  
	`bšch¼CF
 (
b0
->
d©a
, 
pos
, &
chrs
);

1359 
	}
}

1367 
	$bnšchr
 (
cÚ¡_b¡ršg
 
b0
, 
pos
, cÚ¡_b¡ršg 
b1
) {

1368 
ch¬F›ld
 
chrs
;

1369 ià(
pos
 < 0 || 
b0
 =ð
NULL
 || b0->
d©a
 == NULL ||

1370 
b0
->
¦’
 <ð
pos
è 
BSTR_ERR
;

1371 ià(
	`buždCh¬F›ld
 (&
chrs
, 
b1
è< 0è 
BSTR_ERR
;

1372 
	`šv”tCh¬F›ld
 (&
chrs
);

1373  
	`bšchrCF
 (
b0
->
d©a
, b0->
¦’
, 
pos
, &
chrs
);

1374 
	}
}

1382 
	$bnšch¼
 (
cÚ¡_b¡ršg
 
b0
, 
pos
, cÚ¡_b¡ršg 
b1
) {

1383 
ch¬F›ld
 
chrs
;

1384 ià(
pos
 < 0 || 
b0
 =ð
NULL
 || b0->
d©a
 == NULL ||

1385 
b0
->
¦’
 < 
pos
è 
BSTR_ERR
;

1386 ià(
pos
 =ð
b0
->
¦’
)…os--;

1387 ià(
	`buždCh¬F›ld
 (&
chrs
, 
b1
è< 0è 
BSTR_ERR
;

1388 
	`šv”tCh¬F›ld
 (&
chrs
);

1389  
	`bšch¼CF
 (
b0
->
d©a
, 
pos
, &
chrs
);

1390 
	}
}

1399 
	$b£t¡r
 (
b¡ršg
 
b0
, 
pos
, 
cÚ¡_b¡ršg
 
b1
, 
fžl
) {

1400 
d
, 
ÃwËn
;

1401 
±rdiff_t
 
pd
;

1402 
b¡ršg
 
aux
 = (b¡ršgè
b1
;

1404 ià(
pos
 < 0 || 
b0
 =ð
NULL
 || b0->
¦’
 < 0 || NULL =ðb0->
d©a
 ||

1405 
b0
->
mËn
 < b0->
¦’
 || b0->mËÀ<ð0è 
BSTR_ERR
;

1406 ià(
b1
 !ð
NULL
 && (b1->
¦’
 < 0 || b1->
d©a
 =ðNULL)è 
BSTR_ERR
;

1408 
d
 = 
pos
;

1411 ià(
NULL
 !ð
aux
) {

1412 ià((
pd
 = (
±rdiff_t
è(
b1
->
d©a
 - 
b0
->d©a)è>ð0 &&…d < (±rdiff_tèb0->
mËn
) {

1413 ià(
NULL
 =ð(
aux
 = 
	`b¡rýy
 (
b1
))è 
BSTR_ERR
;

1415 
d
 +ð
aux
->
¦’
;

1419 ià(
	`b®loc
 (
b0
, 
d
 + 1è!ð
BSTR_OK
) {

1420 ià(
aux
 !ð
b1
è
	`bde¡roy
 (aux);

1421  
BSTR_ERR
;

1424 
ÃwËn
 = 
b0
->
¦’
;

1427 ià(
pos
 > 
ÃwËn
) {

1428 
	`b¡r__mem£t
 (
b0
->
d©a
 + b0->
¦’
, (è
fžl
, (
size_t
è(
pos
 - b0->slen));

1429 
ÃwËn
 = 
pos
;

1433 ià(
aux
 !ð
NULL
) {

1434 
	`bBlockCÝy
 ((*è(
b0
->
d©a
 + 
pos
), (*è
aux
->d©a,‡ux->
¦’
);

1435 ià(
aux
 !ð
b1
è
	`bde¡roy
 (aux);

1439 ià(
d
 > 
ÃwËn
)‚ewlen = d;

1441 
b0
->
¦’
 = 
ÃwËn
;

1442 
b0
->
d©a
[
ÃwËn
] = () '\0';

1444  
BSTR_OK
;

1445 
	}
}

1454 
	$bš£¹
 (
b¡ršg
 
b1
, 
pos
, 
cÚ¡_b¡ršg
 
b2
, 
fžl
) {

1455 
d
, 
l
;

1456 
±rdiff_t
 
pd
;

1457 
b¡ršg
 
aux
 = (b¡ršgè
b2
;

1459 ià(
pos
 < 0 || 
b1
 =ð
NULL
 || 
b2
 =ðNULL || b1->
¦’
 < 0 ||

1460 
b2
->
¦’
 < 0 || 
b1
->
mËn
 < b1->¦’ || b1->mËÀ<ð0è 
BSTR_ERR
;

1463 ià((
pd
 = (
±rdiff_t
è(
b2
->
d©a
 - 
b1
->d©a)è>ð0 &&…d < (±rdiff_tèb1->
mËn
) {

1464 ià(
NULL
 =ð(
aux
 = 
	`b¡rýy
 (
b2
))è 
BSTR_ERR
;

1468 
d
 = 
b1
->
¦’
 + 
aux
->slen;

1469 
l
 = 
pos
 + 
aux
->
¦’
;

1470 ià((
d
|
l
è< 0è 
BSTR_ERR
;

1472 ià(
l
 > 
d
) {

1474 ià(
	`b®loc
 (
b1
, 
l
 + 1è!ð
BSTR_OK
) {

1475 ià(
aux
 !ð
b2
è
	`bde¡roy
 (aux);

1476  
BSTR_ERR
;

1478 
	`b¡r__mem£t
 (
b1
->
d©a
 + b1->
¦’
, (è
fžl
, (
size_t
è(
pos
 - b1->slen));

1479 
b1
->
¦’
 = 
l
;

1482 ià(
	`b®loc
 (
b1
, 
d
 + 1è!ð
BSTR_OK
) {

1483 ià(
aux
 !ð
b2
è
	`bde¡roy
 (aux);

1484  
BSTR_ERR
;

1486 
	`bBlockCÝy
 (
b1
->
d©a
 + 
l
, b1->d©¨+ 
pos
, 
d
 -†);

1487 
b1
->
¦’
 = 
d
;

1489 
	`bBlockCÝy
 (
b1
->
d©a
 + 
pos
, 
aux
->d©a,‡ux->
¦’
);

1490 
b1
->
d©a
[b1->
¦’
] = () '\0';

1491 ià(
aux
 !ð
b2
è
	`bde¡roy
 (aux);

1492  
BSTR_OK
;

1493 
	}
}

1501 
	$b»¶aû
 (
b¡ršg
 
b1
, 
pos
, 
Ën
, 
cÚ¡_b¡ršg
 
b2
,

1502 
fžl
) {

1503 
¶
, 
»t
;

1504 
±rdiff_t
 
pd
;

1505 
b¡ršg
 
aux
 = (b¡ršgè
b2
;

1507 ià(
pos
 < 0 || 
Ën
 < 0 || (
¶
 =…o +†’è< 0 || 
b1
 =ð
NULL
 ||

1508 
b2
 =ð
NULL
 || 
b1
->
d©a
 == NULL || b2->data == NULL ||

1509 
b1
->
¦’
 < 0 || 
b2
->¦’ < 0 || b1->
mËn
 < b1->slen ||

1510 
b1
->
mËn
 <ð0è 
BSTR_ERR
;

1513 ià(
¶
 >ð
b1
->
¦’
) {

1514 ià((
»t
 = 
	`b£t¡r
 (
b1
, 
pos
, 
b2
, 
fžl
)) < 0) „et;

1515 ià(
pos
 + 
b2
->
¦’
 < 
b1
->slen) {

1516 
b1
->
¦’
 = 
pos
 + 
b2
->slen;

1517 
b1
->
d©a
[b1->
¦’
] = () '\0';

1519  
»t
;

1523 ià((
pd
 = (
±rdiff_t
è(
b2
->
d©a
 - 
b1
->d©a)è>ð0 &&…d < (±rdiff_tèb1->
¦’
) {

1524 ià(
NULL
 =ð(
aux
 = 
	`b¡rýy
 (
b2
))è 
BSTR_ERR
;

1527 ià(
aux
->
¦’
 > 
Ën
) {

1528 ià(
	`b®loc
 (
b1
, b1->
¦’
 + 
aux
->¦’ - 
Ën
è!ð
BSTR_OK
) {

1529 ià(
aux
 !ð
b2
è
	`bde¡roy
 (aux);

1530  
BSTR_ERR
;

1534 ià(
aux
->
¦’
 !ð
Ën
è
	`b¡r__memmove
 (
b1
->
d©a
 + 
pos
 +‡ux->slen, b1->data +…os +†en, b1->slen - (pos +†en));

1535 
	`b¡r__memýy
 (
b1
->
d©a
 + 
pos
, 
aux
->d©a,‡ux->
¦’
);

1536 
b1
->
¦’
 +ð
aux
->¦’ - 
Ën
;

1537 
b1
->
d©a
[b1->
¦’
] = () '\0';

1538 ià(
aux
 !ð
b2
è
	`bde¡roy
 (aux);

1539  
BSTR_OK
;

1540 
	}
}

1549 (*
	tš¡r_â±r
è(
	tcÚ¡_b¡ršg
 
	ts1
, 
	tpos
, cÚ¡_b¡ršg 
	ts2
);

1551 
	#INITIAL_STATIC_FIND_INDEX_COUNT
 32

	)

1553 
	$fšd»¶aû’gše
 (
b¡ršg
 
b
, 
cÚ¡_b¡ršg
 
fšd
, cÚ¡_b¡ršg 
»¶
, 
pos
, 
š¡r_â±r
 
š¡r
) {

1554 
i
, 
»t
, 
¦’
, 
mËn
, 
d–
, 
acc
;

1555 * 
d
;

1556 
¡©ic_d
[
INITIAL_STATIC_FIND_INDEX_COUNT
+1];

1557 
±rdiff_t
 
pd
;

1558 
b¡ršg
 
auxf
 = (b¡ršgè
fšd
;

1559 
b¡ršg
 
auxr
 = (b¡ršgè
»¶
;

1561 ià(
b
 =ð
NULL
 || b->
d©a
 =ðNULL || 
fšd
 == NULL ||

1562 
fšd
->
d©a
 =ð
NULL
 || 
»¶
 == NULL ||„epl->data == NULL ||

1563 
pos
 < 0 || 
fšd
->
¦’
 <ð0 || 
b
->
mËn
 < 0 || b->slen > b->mlen ||

1564 
b
->
mËn
 <ð0 || b->
¦’
 < 0 || 
»¶
->¦’ < 0è 
BSTR_ERR
;

1565 ià(
pos
 > 
b
->
¦’
 - 
fšd
->¦’è 
BSTR_OK
;

1568 
pd
 = (
±rdiff_t
è(
fšd
->
d©a
 - 
b
->data);

1569 ià((
±rdiff_t
è(
pos
 - 
fšd
->
¦’
è< 
pd
 &&…d < (±rdiff_tè
b
->slen) {

1570 ià(
NULL
 =ð(
auxf
 = 
	`b¡rýy
 (
fšd
))è 
BSTR_ERR
;

1574 
pd
 = (
±rdiff_t
è(
»¶
->
d©a
 - 
b
->data);

1575 ià((
±rdiff_t
è(
pos
 - 
»¶
->
¦’
è< 
pd
 &&…d < (±rdiff_tè
b
->slen) {

1576 ià(
NULL
 =ð(
auxr
 = 
	`b¡rýy
 (
»¶
))) {

1577 ià(
auxf
 !ð
fšd
è
	`bde¡roy
 (auxf);

1578  
BSTR_ERR
;

1582 
d–
 = 
auxf
->
¦’
 - 
auxr
->slen;

1586 ià(
d–
 == 0) {

1587 (
pos
 = 
	`š¡r
 (
b
,…os, 
auxf
)) >= 0) {

1588 
	`b¡r__memýy
 (
b
->
d©a
 + 
pos
, 
auxr
->d©a,‡uxr->
¦’
);

1589 
pos
 +ð
auxf
->
¦’
;

1591 ià(
auxf
 !ð
fšd
è
	`bde¡roy
 (auxf);

1592 ià(
auxr
 !ð
»¶
è
	`bde¡roy
 (auxr);

1593  
BSTR_OK
;

1597 ià(
d–
 > 0) {

1598 
acc
 = 0;

1600 (
i
 = 
	`š¡r
 (
b
, 
pos
, 
auxf
)) >= 0) {

1601 ià(
acc
 && 
i
 > 
pos
)

1602 
	`b¡r__memmove
 (
b
->
d©a
 + 
pos
 - 
acc
, b->d©¨+…os, 
i
 -…os);

1603 ià(
auxr
->
¦’
)

1604 
	`b¡r__memýy
 (
b
->
d©a
 + 
i
 - 
acc
, 
auxr
->d©a,‡uxr->
¦’
);

1605 
acc
 +ð
d–
;

1606 
pos
 = 
i
 + 
auxf
->
¦’
;

1609 ià(
acc
) {

1610 
i
 = 
b
->
¦’
;

1611 ià(
i
 > 
pos
)

1612 
	`b¡r__memmove
 (
b
->
d©a
 + 
pos
 - 
acc
, b->d©¨+…os, 
i
 -…os);

1613 
b
->
¦’
 -ð
acc
;

1614 
b
->
d©a
[b->
¦’
] = () '\0';

1617 ià(
auxf
 !ð
fšd
è
	`bde¡roy
 (auxf);

1618 ià(
auxr
 !ð
»¶
è
	`bde¡roy
 (auxr);

1619  
BSTR_OK
;

1636 
mËn
 = 
INITIAL_STATIC_FIND_INDEX_COUNT
;

1637 
d
 = (*è
¡©ic_d
;

1638 
acc
 = 
¦’
 = 0;

1640 (
pos
 = 
	`š¡r
 (
b
,…os, 
auxf
)) >= 0) {

1641 ià(
¦’
 >ð
mËn
 - 1) {

1642 *
t
;

1643 
¦
;

1644 
mËn
 += mlen;

1645 
¦
 =  (*è* 
mËn
;

1646 ià(
¡©ic_d
 =ð
d
èd = 
NULL
;

1647 ià(
mËn
 <ð0 || 
¦
 < mËÀ|| 
NULL
 =ð(
t
 = (*è
	`b¡r__»®loc
 (
d
, sl))) {

1648 
»t
 = 
BSTR_ERR
;

1649 
dÚe
;

1651 ià(
NULL
 =ð
d
è
	`b¡r__memýy
 (
t
, 
¡©ic_d
,  (static_d));

1652 
d
 = 
t
;

1654 
d
[
¦’
] = 
pos
;

1655 
¦’
++;

1656 
acc
 -ð
d–
;

1657 
pos
 +ð
auxf
->
¦’
;

1658 ià(
pos
 < 0 || 
acc
 < 0) {

1659 
»t
 = 
BSTR_ERR
;

1660 
dÚe
;

1665 
d
[
¦’
] = 
b
->slen;

1667 ià(
BSTR_OK
 =ð(
»t
 = 
	`b®loc
 (
b
, b->
¦’
 + 
acc
 + 1))) {

1668 
b
->
¦’
 +ð
acc
;

1669 
i
 = 
¦’
-1; i >= 0; i--) {

1670 
s
, 
l
;

1671 
s
 = 
d
[
i
] + 
auxf
->
¦’
;

1672 
l
 = 
d
[
i
+1] - 
s
;

1673 ià(
l
) {

1674 
	`b¡r__memmove
 (
b
->
d©a
 + 
s
 + 
acc
, b->d©¨+ s, 
l
);

1676 ià(
auxr
->
¦’
) {

1677 
	`b¡r__memmove
 (
b
->
d©a
 + 
s
 + 
acc
 - 
auxr
->
¦’
,

1678 
auxr
->
d©a
,‡uxr->
¦’
);

1680 
acc
 +ð
d–
;

1682 
b
->
d©a
[b->
¦’
] = () '\0';

1685 
dÚe
:;

1686 ià(
¡©ic_d
 !ð
d
è
	`b¡r__ä“
 (d);

1687 ià(
auxf
 !ð
fšd
è
	`bde¡roy
 (auxf);

1688 ià(
auxr
 !ð
»¶
è
	`bde¡roy
 (auxr);

1689  
»t
;

1690 
	}
}

1698 
	$bfšd»¶aû
 (
b¡ršg
 
b
, 
cÚ¡_b¡ršg
 
fšd
, cÚ¡_b¡ršg 
»¶
, 
pos
) {

1699  
	`fšd»¶aû’gše
 (
b
, 
fšd
, 
»¶
, 
pos
, 
bš¡r
);

1700 
	}
}

1708 
	$bfšd»¶aûÿ£Ëss
 (
b¡ršg
 
b
, 
cÚ¡_b¡ršg
 
fšd
, cÚ¡_b¡ršg 
»¶
, 
pos
) {

1709  
	`fšd»¶aû’gše
 (
b
, 
fšd
, 
»¶
, 
pos
, 
bš¡rÿ£Ëss
);

1710 
	}
}

1719 
	$bš£¹ch
 (
b¡ršg
 
b
, 
pos
, 
Ën
, 
fžl
) {

1720 
d
, 
l
, 
i
;

1722 ià(
pos
 < 0 || 
b
 =ð
NULL
 || b->
¦’
 < 0 || b->
mËn
 < b->slen ||

1723 
b
->
mËn
 <ð0 || 
Ën
 < 0è 
BSTR_ERR
;

1726 
d
 = 
b
->
¦’
 + 
Ën
;

1727 
l
 = 
pos
 + 
Ën
;

1728 ià((
d
|
l
è< 0è 
BSTR_ERR
;

1730 ià(
l
 > 
d
) {

1732 ià(
	`b®loc
 (
b
, 
l
 + 1è!ð
BSTR_OK
è 
BSTR_ERR
;

1733 
pos
 = 
b
->
¦’
;

1734 
b
->
¦’
 = 
l
;

1737 ià(
	`b®loc
 (
b
, 
d
 + 1è!ð
BSTR_OK
è 
BSTR_ERR
;

1738 
i
 = 
d
 - 1; i >ð
l
; i--) {

1739 
b
->
d©a
[
i
] = b->d©a[˜- 
Ën
];

1741 
b
->
¦’
 = 
d
;

1744 
i
=
pos
; i < 
l
; i++è
b
->
d©a
[i] = 
fžl
;

1745 
b
->
d©a
[b->
¦’
] = () '\0';

1746  
BSTR_OK
;

1747 
	}
}

1756 
	$b·‰”n
 (
b¡ršg
 
b
, 
Ën
) {

1757 
i
, 
d
;

1759 
d
 = 
	`bËngth
 (
b
);

1760 ià(
d
 <ð0 || 
Ën
 < 0 || 
	`b®loc
 (
b
,†’ + 1è!ð
BSTR_OK
è 
BSTR_ERR
;

1761 ià(
Ën
 > 0) {

1762 ià(
d
 =ð1è 
	`b£t¡r
 (
b
, 
Ën
, 
NULL
, b->
d©a
[0]);

1763 
i
 = 
d
; i < 
Ën
; i++è
b
->
d©a
[i] = b->data[i - d];

1765 
b
->
d©a
[
Ën
] = () '\0';

1766 
b
->
¦’
 = 
Ën
;

1767  
BSTR_OK
;

1768 
	}
}

1770 
	#BS_BUFF_SZ
 (1024)

	)

1778 
	$b»ada
 (
b¡ršg
 
b
, 
bN»ad
 
»adPŒ
, * 
·rm
) {

1779 
i
, 
l
, 
n
;

1781 ià(
b
 =ð
NULL
 || b->
mËn
 <ð0 || b->
¦’
 < 0 || b->mlen < b->slen ||

1782 
b
->
mËn
 <ð0 || 
»adPŒ
 =ð
NULL
è 
BSTR_ERR
;

1784 
i
 = 
b
->
¦’
;

1785 
n
=
i
+16; ;‚ +ð(Ò < 
BS_BUFF_SZ
) ?‚ : BS_BUFF_SZ)) {

1786 ià(
BSTR_OK
 !ð
	`b®loc
 (
b
, 
n
 + 1)è 
BSTR_ERR
;

1787 
l
 = (è
	`»adPŒ
 ((*è(
b
->
d©a
 + 
i
), 1, 
n
 - i, 
·rm
);

1788 
i
 +ð
l
;

1789 
b
->
¦’
 = 
i
;

1790 ià(
i
 < 
n
) ;

1793 
b
->
d©a
[
i
] = () '\0';

1794  
BSTR_OK
;

1795 
	}
}

1803 
b¡ršg
 
	$b»ad
 (
bN»ad
 
»adPŒ
, * 
·rm
) {

1804 
b¡ršg
 
buff
;

1806 ià(0 > 
	`b»ada
 (
buff
 = 
	`bäomc¡r
 (""), 
»adPŒ
, 
·rm
)) {

1807 
	`bde¡roy
 (
buff
);

1808  
NULL
;

1810  
buff
;

1811 
	}
}

1826 
	$bassigng‘s
 (
b¡ršg
 
b
, 
bNg‘c
 
g‘cPŒ
, * 
·rm
, 
‹rmš©Ü
) {

1827 
c
, 
d
, 
e
;

1829 ià(
b
 =ð
NULL
 || b->
mËn
 <ð0 || b->
¦’
 < 0 || b->mlen < b->slen ||

1830 
b
->
mËn
 <ð0 || 
g‘cPŒ
 =ð
NULL
è 
BSTR_ERR
;

1831 
d
 = 0;

1832 
e
 = 
b
->
mËn
 - 2;

1834 (
c
 = 
	`g‘cPŒ
 (
·rm
)) >= 0) {

1835 ià(
d
 > 
e
) {

1836 
b
->
¦’
 = 
d
;

1837 ià(
	`b®loc
 (
b
, 
d
 + 2è!ð
BSTR_OK
è 
BSTR_ERR
;

1838 
e
 = 
b
->
mËn
 - 2;

1840 
b
->
d©a
[
d
] = (è
c
;

1841 
d
++;

1842 ià(
c
 =ð
‹rmš©Ü
) ;

1845 
b
->
d©a
[
d
] = () '\0';

1846 
b
->
¦’
 = 
d
;

1848  
d
 =ð0 && 
c
 < 0;

1849 
	}
}

1864 
	$bg‘§
 (
b¡ršg
 
b
, 
bNg‘c
 
g‘cPŒ
, * 
·rm
, 
‹rmš©Ü
) {

1865 
c
, 
d
, 
e
;

1867 ià(
b
 =ð
NULL
 || b->
mËn
 <ð0 || b->
¦’
 < 0 || b->mlen < b->slen ||

1868 
b
->
mËn
 <ð0 || 
g‘cPŒ
 =ð
NULL
è 
BSTR_ERR
;

1869 
d
 = 
b
->
¦’
;

1870 
e
 = 
b
->
mËn
 - 2;

1872 (
c
 = 
	`g‘cPŒ
 (
·rm
)) >= 0) {

1873 ià(
d
 > 
e
) {

1874 
b
->
¦’
 = 
d
;

1875 ià(
	`b®loc
 (
b
, 
d
 + 2è!ð
BSTR_OK
è 
BSTR_ERR
;

1876 
e
 = 
b
->
mËn
 - 2;

1878 
b
->
d©a
[
d
] = (è
c
;

1879 
d
++;

1880 ià(
c
 =ð
‹rmš©Ü
) ;

1883 
b
->
d©a
[
d
] = () '\0';

1884 
b
->
¦’
 = 
d
;

1886  
d
 =ð0 && 
c
 < 0;

1887 
	}
}

1900 
b¡ršg
 
	$bg‘s
 (
bNg‘c
 
g‘cPŒ
, * 
·rm
, 
‹rmš©Ü
) {

1901 
b¡ršg
 
buff
;

1903 ià(0 > 
	`bg‘§
 (
buff
 = 
	`bäomc¡r
 (""), 
g‘cPŒ
, 
·rm
, 
‹rmš©Ü
è|| 0 >ðbuff->
¦’
) {

1904 
	`bde¡roy
 (
buff
);

1905 
buff
 = 
NULL
;

1907  
buff
;

1908 
	}
}

1910 
	sbSŒ—m
 {

1911 
b¡ršg
 
	mbuff
;

1912 * 
	m·rm
;

1913 
bN»ad
 
	m»adFnPŒ
;

1914 
	misEOF
;

1915 
	mmaxBuffSz
;

1924 
bSŒ—m
 * 
	$bsÝ’
 (
bN»ad
 
»adPŒ
, * 
·rm
) {

1925 
bSŒ—m
 * 
s
;

1927 ià(
»adPŒ
 =ð
NULL
)  NULL;

1928 
s
 = (
bSŒ—m
 *è
	`b¡r__®loc
 ( (bStream));

1929 ià(
s
 =ð
NULL
)  NULL;

1930 
s
->
·rm
 =…arm;

1931 
s
->
buff
 = 
	`bäomc¡r
 ("");

1932 
s
->
»adFnPŒ
 = 
»adPŒ
;

1933 
s
->
maxBuffSz
 = 
BS_BUFF_SZ
;

1934 
s
->
isEOF
 = 0;

1935  
s
;

1936 
	}
}

1943 
	$bsbufæ’gth
 (
bSŒ—m
 * 
s
, 
sz
) {

1944 
ÞdSz
;

1945 ià(
s
 =ð
NULL
 || 
sz
 < 0è 
BSTR_ERR
;

1946 
ÞdSz
 = 
s
->
maxBuffSz
;

1947 ià(
sz
 > 0è
s
->
maxBuffSz
 = sz;

1948  
ÞdSz
;

1949 
	}
}

1951 
	$b£of
 (cÚ¡ 
bSŒ—m
 * 
s
) {

1952 ià(
s
 =ð
NULL
 || s->
»adFnPŒ
 =ðNULLè 
BSTR_ERR
;

1953  
s
->
isEOF
 && (s->
buff
->
¦’
 == 0);

1954 
	}
}

1961 * 
	$bsþo£
 (
bSŒ—m
 * 
s
) {

1962 * 
·rm
;

1963 ià(
s
 =ð
NULL
)  NULL;

1964 
s
->
»adFnPŒ
 = 
NULL
;

1965 ià(
s
->
buff
è
	`bde¡roy
 (s->buff);

1966 
s
->
buff
 = 
NULL
;

1967 
·rm
 = 
s
->parm;

1968 
s
->
·rm
 = 
NULL
;

1969 
s
->
isEOF
 = 1;

1970 
	`b¡r__ä“
 (
s
);

1971  
·rm
;

1972 
	}
}

1981 
	$b¤—dÊa
 (
b¡ršg
 
r
, 
bSŒ—m
 * 
s
, 
‹rmš©Ü
) {

1982 
i
, 
l
, 
»t
, 
¾o
;

1983 * 
b
;

1984 
gb¡ršg
 
x
;

1986 ià(
s
 =ð
NULL
 || s->
buff
 =ðNULL || 
r
 =ðNULL ||„->
mËn
 <= 0 ||

1987 
r
->
¦’
 < 0 ||„->
mËn
 <„->¦’è 
BSTR_ERR
;

1988 
l
 = 
s
->
buff
->
¦’
;

1989 ià(
BSTR_OK
 !ð
	`b®loc
 (
s
->
buff
, s->
maxBuffSz
 + 1)è 
BSTR_ERR
;

1990 
b
 = (*è
s
->
buff
->
d©a
;

1991 
x
.
d©a
 = (*è
b
;

1994 
b
[
l
] = 
‹rmš©Ü
;

1995 
i
=0; 
b
[i] !ð
‹rmš©Ü
; i++) ;

1996 ià(
i
 < 
l
) {

1997 
x
.
¦’
 = 
i
 + 1;

1998 
»t
 = 
	`bcÚÿt
 (
r
, &
x
);

1999 
s
->
buff
->
¦’
 = 
l
;

2000 ià(
BSTR_OK
 =ð
»t
è
	`bd–‘e
 (
s
->
buff
, 0, 
i
 + 1);

2001  
BSTR_OK
;

2004 
¾o
 = 
r
->
¦’
;

2007 
x
.
¦’
 = 
l
;

2008 ià(
BSTR_OK
 !ð
	`bcÚÿt
 (
r
, &
x
)è 
BSTR_ERR
;

2013 ià(
BSTR_OK
 !ð
	`b®loc
 (
r
,„->
¦’
 + 
s
->
maxBuffSz
 + 1)è 
BSTR_ERR
;

2014 
b
 = (*è(
r
->
d©a
 +„->
¦’
);

2015 
l
 = (è
s
->
	`»adFnPŒ
 (
b
, 1, s->
maxBuffSz
, s->
·rm
);

2016 ià(
l
 <= 0) {

2017 
r
->
d©a
[r->
¦’
] = () '\0';

2018 
s
->
buff
->
¦’
 = 0;

2019 
s
->
isEOF
 = 1;

2021  
BSTR_ERR
 & -(
r
->
¦’
 =ð
¾o
);

2023 
b
[
l
] = 
‹rmš©Ü
;

2024 
i
=0; 
b
[i] !ð
‹rmš©Ü
; i++) ;

2025 ià(
i
 < 
l
) ;

2026 
r
->
¦’
 +ð
l
;

2030 
i
++;

2031 
r
->
¦’
 +ð
i
;

2032 
s
->
buff
->
¦’
 = 
l
 - 
i
;

2033 
	`b¡r__memýy
 (
s
->
buff
->
d©a
, 
b
 + 
i
, 
l
 - i);

2034 
r
->
d©a
[r->
¦’
] = () '\0';

2035  
BSTR_OK
;

2036 
	}
}

2045 
	$b¤—dÊ§
 (
b¡ršg
 
r
, 
bSŒ—m
 * 
s
, 
cÚ¡_b¡ršg
 
‹rm
) {

2046 
i
, 
l
, 
»t
, 
¾o
;

2047 * 
b
;

2048 
gb¡ršg
 
x
;

2049 
ch¬F›ld
 
cf
;

2051 ià(
s
 =ð
NULL
 || s->
buff
 =ðNULL || 
r
 =ðNULL || 
‹rm
 == NULL ||

2052 
‹rm
->
d©a
 =ð
NULL
 || 
r
->
mËn
 <ð0 ||„->
¦’
 < 0 ||

2053 
r
->
mËn
 <„->
¦’
è 
BSTR_ERR
;

2054 ià(
‹rm
->
¦’
 =ð1è 
	`b¤—dÊa
 (
r
, 
s
,”m->
d©a
[0]);

2055 ià(
‹rm
->
¦’
 < 1 || 
	`buždCh¬F›ld
 (&
cf
,”m)è 
BSTR_ERR
;

2057 
l
 = 
s
->
buff
->
¦’
;

2058 ià(
BSTR_OK
 !ð
	`b®loc
 (
s
->
buff
, s->
maxBuffSz
 + 1)è 
BSTR_ERR
;

2059 
b
 = (*è
s
->
buff
->
d©a
;

2060 
x
.
d©a
 = 
b
;

2063 
b
[
l
] = 
‹rm
->
d©a
[0];

2064 
i
=0; !
	`‹¡InCh¬F›ld
 (&
cf
, 
b
[i]); i++) ;

2065 ià(
i
 < 
l
) {

2066 
x
.
¦’
 = 
i
 + 1;

2067 
»t
 = 
	`bcÚÿt
 (
r
, &
x
);

2068 
s
->
buff
->
¦’
 = 
l
;

2069 ià(
BSTR_OK
 =ð
»t
è
	`bd–‘e
 (
s
->
buff
, 0, 
i
 + 1);

2070  
BSTR_OK
;

2073 
¾o
 = 
r
->
¦’
;

2076 
x
.
¦’
 = 
l
;

2077 ià(
BSTR_OK
 !ð
	`bcÚÿt
 (
r
, &
x
)è 
BSTR_ERR
;

2082 ià(
BSTR_OK
 !ð
	`b®loc
 (
r
,„->
¦’
 + 
s
->
maxBuffSz
 + 1)è 
BSTR_ERR
;

2083 
b
 = (*è(
r
->
d©a
 +„->
¦’
);

2084 
l
 = (è
s
->
	`»adFnPŒ
 (
b
, 1, s->
maxBuffSz
, s->
·rm
);

2085 ià(
l
 <= 0) {

2086 
r
->
d©a
[r->
¦’
] = () '\0';

2087 
s
->
buff
->
¦’
 = 0;

2088 
s
->
isEOF
 = 1;

2090  
BSTR_ERR
 & -(
r
->
¦’
 =ð
¾o
);

2093 
b
[
l
] = 
‹rm
->
d©a
[0];

2094 
i
=0; !
	`‹¡InCh¬F›ld
 (&
cf
, 
b
[i]); i++) ;

2095 ià(
i
 < 
l
) ;

2096 
r
->
¦’
 +ð
l
;

2100 
i
++;

2101 
r
->
¦’
 +ð
i
;

2102 
s
->
buff
->
¦’
 = 
l
 - 
i
;

2103 
	`b¡r__memýy
 (
s
->
buff
->
d©a
, 
b
 + 
i
, 
l
 - i);

2104 
r
->
d©a
[r->
¦’
] = () '\0';

2105  
BSTR_OK
;

2106 
	}
}

2116 
	$b¤—da
 (
b¡ršg
 
r
, 
bSŒ—m
 * 
s
, 
n
) {

2117 
l
, 
»t
, 
Ü¦’
;

2118 * 
b
;

2119 
gb¡ršg
 
x
;

2121 ià(
s
 =ð
NULL
 || s->
buff
 =ðNULL || 
r
 =ðNULL ||„->
mËn
 <= 0

2122 || 
r
->
¦’
 < 0 ||„->
mËn
 <„->¦’ || 
n
 <ð0è 
BSTR_ERR
;

2124 
n
 +ð
r
->
¦’
;

2125 ià(
n
 <ð0è 
BSTR_ERR
;

2127 
l
 = 
s
->
buff
->
¦’
;

2129 
Ü¦’
 = 
r
->
¦’
;

2131 ià(0 =ð
l
) {

2132 ià(
s
->
isEOF
è 
BSTR_ERR
;

2133 ià(
r
->
mËn
 > 
n
) {

2134 
l
 = (è
s
->
	`»adFnPŒ
 (
r
->
d©a
 +„->
¦’
, 1, 
n
 -„->¦’, s->
·rm
);

2135 ià(0 >ð
l
 ||† > 
n
 - 
r
->
¦’
) {

2136 
s
->
isEOF
 = 1;

2137  
BSTR_ERR
;

2139 
r
->
¦’
 +ð
l
;

2140 
r
->
d©a
[r->
¦’
] = () '\0';

2145 ià(
BSTR_OK
 !ð
	`b®loc
 (
s
->
buff
, s->
maxBuffSz
 + 1)è 
BSTR_ERR
;

2146 
b
 = (*è
s
->
buff
->
d©a
;

2147 
x
.
d©a
 = (*è
b
;

2150 ià(
l
 + 
r
->
¦’
 >ð
n
) {

2151 
x
.
¦’
 = 
n
 - 
r
->slen;

2152 
»t
 = 
	`bcÚÿt
 (
r
, &
x
);

2153 
s
->
buff
->
¦’
 = 
l
;

2154 ià(
BSTR_OK
 =ð
»t
è
	`bd–‘e
 (
s
->
buff
, 0, 
x
.
¦’
);

2155  
BSTR_ERR
 & -(
r
->
¦’
 =ð
Ü¦’
);

2158 
x
.
¦’
 = 
l
;

2159 ià(
BSTR_OK
 !ð
	`bcÚÿt
 (
r
, &
x
)) ;

2161 
l
 = 
n
 - 
r
->
¦’
;

2162 ià(
l
 > 
s
->
maxBuffSz
)† = s->maxBuffSz;

2164 
l
 = (è
s
->
	`»adFnPŒ
 (
b
, 1,†, s->
·rm
);

2166 } 
l
 > 0);

2167 ià(
l
 < 0)† = 0;

2168 ià(
l
 =ð0è
s
->
isEOF
 = 1;

2169 
s
->
buff
->
¦’
 = 
l
;

2170  
BSTR_ERR
 & -(
r
->
¦’
 =ð
Ü¦’
);

2171 
	}
}

2180 
	$b¤—dÊ
 (
b¡ršg
 
r
, 
bSŒ—m
 * 
s
, 
‹rmš©Ü
) {

2181 ià(
s
 =ð
NULL
 || s->
buff
 =ðNULL || 
r
 =ðNULL ||„->
mËn
 <= 0)

2182  
BSTR_ERR
;

2183 ià(
BSTR_OK
 !ð
	`b®loc
 (
s
->
buff
, s->
maxBuffSz
 + 1)è 
BSTR_ERR
;

2184 
r
->
¦’
 = 0;

2185  
	`b¤—dÊa
 (
r
, 
s
, 
‹rmš©Ü
);

2186 
	}
}

2195 
	$b¤—dÊs
 (
b¡ršg
 
r
, 
bSŒ—m
 * 
s
, 
cÚ¡_b¡ršg
 
‹rm
) {

2196 ià(
s
 =ð
NULL
 || s->
buff
 =ðNULL || 
r
 =ðNULL || 
‹rm
 == NULL

2197 || 
‹rm
->
d©a
 =ð
NULL
 || 
r
->
mËn
 <ð0è 
BSTR_ERR
;

2198 ià(
‹rm
->
¦’
 =ð1è 
	`b¤—dÊ
 (
r
, 
s
,”m->
d©a
[0]);

2199 ià(
‹rm
->
¦’
 < 1è 
BSTR_ERR
;

2200 ià(
BSTR_OK
 !ð
	`b®loc
 (
s
->
buff
, s->
maxBuffSz
 + 1)è 
BSTR_ERR
;

2201 
r
->
¦’
 = 0;

2202  
	`b¤—dÊ§
 (
r
, 
s
, 
‹rm
);

2203 
	}
}

2213 
	$b¤—d
 (
b¡ršg
 
r
, 
bSŒ—m
 * 
s
, 
n
) {

2214 ià(
s
 =ð
NULL
 || s->
buff
 =ðNULL || 
r
 =ðNULL ||„->
mËn
 <= 0

2215 || 
n
 <ð0è 
BSTR_ERR
;

2216 ià(
BSTR_OK
 !ð
	`b®loc
 (
s
->
buff
, s->
maxBuffSz
 + 1)è 
BSTR_ERR
;

2217 
r
->
¦’
 = 0;

2218  
	`b¤—da
 (
r
, 
s
, 
n
);

2219 
	}
}

2227 
	$bsuÄ—d
 (
bSŒ—m
 * 
s
, 
cÚ¡_b¡ršg
 
b
) {

2228 ià(
s
 =ð
NULL
 || s->
buff
 =ðNULLè 
BSTR_ERR
;

2229  
	`bš£¹
 (
s
->
buff
, 0, 
b
, () '?');

2230 
	}
}

2237 
	$b¥“k
 (
b¡ršg
 
r
, cÚ¡ 
bSŒ—m
 * 
s
) {

2238 ià(
s
 =ð
NULL
 || s->
buff
 =ðNULLè 
BSTR_ERR
;

2239  
	`bassign
 (
r
, 
s
->
buff
);

2240 
	}
}

2248 
b¡ršg
 
	$bjoš
 (cÚ¡ 
b¡rLi¡
 * 
bl
, 
cÚ¡_b¡ršg
 
£p
) {

2249 
b¡ršg
 
b
;

2250 
i
, 
c
, 
v
;

2252 ià(
bl
 =ð
NULL
 || bl->
qty
 < 0)  NULL;

2253 ià(
£p
 !ð
NULL
 && (£p->
¦’
 < 0 || s•->
d©a
 == NULL))  NULL;

2255 
i
 = 0, 
c
 = 1; i < 
bl
->
qty
; i++) {

2256 
v
 = 
bl
->
’Œy
[
i
]->
¦’
;

2257 ià(
v
 < 0è 
NULL
;

2258 
c
 +ð
v
;

2259 ià(
c
 < 0è 
NULL
;

2262 ià(
£p
 !ð
NULL
è
c
 +ð(
bl
->
qty
 - 1è* s•->
¦’
;

2264 
b
 = (
b¡ršg
è
	`b¡r__®loc
 ( (
gb¡ršg
));

2265 ià(
NULL
 =ð
b
)  NULL;

2266 
b
->
d©a
 = (*è
	`b¡r__®loc
 (
c
);

2267 ià(
b
->
d©a
 =ð
NULL
) {

2268 
	`b¡r__ä“
 (
b
);

2269  
NULL
;

2272 
b
->
mËn
 = 
c
;

2273 
b
->
¦’
 = 
c
-1;

2275 
i
 = 0, 
c
 = 0; i < 
bl
->
qty
; i++) {

2276 ià(
i
 > 0 && 
£p
 !ð
NULL
) {

2277 
	`b¡r__memýy
 (
b
->
d©a
 + 
c
, 
£p
->d©a, s•->
¦’
);

2278 
c
 +ð
£p
->
¦’
;

2280 
v
 = 
bl
->
’Œy
[
i
]->
¦’
;

2281 
	`b¡r__memýy
 (
b
->
d©a
 + 
c
, 
bl
->
’Œy
[
i
]->d©a, 
v
);

2282 
c
 +ð
v
;

2284 
b
->
d©a
[
c
] = () '\0';

2285  
b
;

2286 
	}
}

2288 
	#BSSSC_BUFF_LEN
 (256)

	)

2307 
bs¥l™scb
 (
bSŒ—m
 * 
s
, 
cÚ¡_b¡ršg
 
¥l™SŒ
,

2308 (* 
cb
è(* 
·rm
, 
ofs
, 
cÚ¡_b¡ršg
 
’Œy
), *…arm) {

2309 
ch¬F›ld
 
chrs
;

2310 
b¡ršg
 
buff
;

2311 
i
, 
p
, 
»t
;

2313 ià(
cb
 =ð
NULL
 || 
s
 =ðNULL || s->
»adFnPŒ
 == NULL

2314 || 
¥l™SŒ
 =ð
NULL
 || s¶™SŒ->
¦’
 < 0è 
BSTR_ERR
;

2316 ià(
NULL
 =ð(
buff
 = 
	`bäomc¡r
 (""))è 
BSTR_ERR
;

2318 ià(
¥l™SŒ
->
¦’
 == 0) {

2319 
	`b¤—da
 (
buff
, 
s
, 
BSSSC_BUFF_LEN
) >= 0) ;

2320 ià((
»t
 = 
	`cb
 (
·rm
, 0, 
buff
)) > 0)

2321 
»t
 = 0;

2323 
	`buždCh¬F›ld
 (&
chrs
, 
¥l™SŒ
);

2324 
»t
 = 
p
 = 
i
 = 0;

2326 ià(
i
 >ð
buff
->
¦’
) {

2327 
	`b¤—da
 (
buff
, 
s
, 
BSSSC_BUFF_LEN
);

2328 ià(
i
 >ð
buff
->
¦’
) {

2329 ià(0 < (
»t
 = 
	`cb
 (
·rm
, 
p
, 
buff
)))„et = 0;

2333 ià(
	`‹¡InCh¬F›ld
 (&
chrs
, 
buff
->
d©a
[
i
])) {

2334 
gb¡ršg
 
t
;

2335 
c
;

2337 
	`blk2tb¡r
 (
t
, 
buff
->
d©a
 + 
i
 + 1, buff->
¦’
 - (i + 1));

2338 ià((
»t
 = 
	`bsuÄ—d
 (
s
, &
t
)) < 0) ;

2339 
buff
->
¦’
 = 
i
;

2340 
c
 = 
buff
->
d©a
[
i
];

2341 
buff
->
d©a
[
i
] = () '\0';

2342 ià((
»t
 = 
	`cb
 (
·rm
, 
p
, 
buff
)) < 0) ;

2343 
buff
->
d©a
[
i
] = 
c
;

2344 
buff
->
¦’
 = 0;

2345 
p
 +ð
i
 + 1;

2346 
i
 = -1;

2348 
i
++;

2352 
	`bde¡roy
 (
buff
);

2353  
»t
;

2354 
	}
}

2373 
bs¥l™¡rcb
 (
bSŒ—m
 * 
s
, 
cÚ¡_b¡ršg
 
¥l™SŒ
,

2374 (* 
cb
è(* 
·rm
, 
ofs
, 
cÚ¡_b¡ršg
 
’Œy
), *…arm) {

2375 
b¡ršg
 
buff
;

2376 
i
, 
p
, 
»t
;

2378 ià(
cb
 =ð
NULL
 || 
s
 =ðNULL || s->
»adFnPŒ
 == NULL

2379 || 
¥l™SŒ
 =ð
NULL
 || s¶™SŒ->
¦’
 < 0è 
BSTR_ERR
;

2381 ià(
¥l™SŒ
->
¦’
 =ð1è 
	`bs¥l™scb
 (
s
, s¶™SŒ, 
cb
, 
·rm
);

2383 ià(
NULL
 =ð(
buff
 = 
	`bäomc¡r
 (""))è 
BSTR_ERR
;

2385 ià(
¥l™SŒ
->
¦’
 == 0) {

2386 
i
=0; 
	`b¤—da
 (
buff
, 
s
, 
BSSSC_BUFF_LEN
) >= 0; i++) {

2387 ià((
»t
 = 
	`cb
 (
·rm
, 0, 
buff
)) < 0) {

2388 
	`bde¡roy
 (
buff
);

2389  
»t
;

2391 
buff
->
¦’
 = 0;

2393  
BSTR_OK
;

2395 
»t
 = 
p
 = 
i
 = 0;

2396 
i
=
p
=0;;) {

2397 ià((
»t
 = 
	`bš¡r
 (
buff
, 0, 
¥l™SŒ
)) >= 0) {

2398 
gb¡ršg
 
t
;

2399 
	`blk2tb¡r
 (
t
, 
buff
->
d©a
, 
»t
);

2400 
i
 = 
»t
 + 
¥l™SŒ
->
¦’
;

2401 ià((
»t
 = 
	`cb
 (
·rm
, 
p
, &
t
)) < 0) ;

2402 
p
 +ð
i
;

2403 
	`bd–‘e
 (
buff
, 0, 
i
);

2405 
	`b¤—da
 (
buff
, 
s
, 
BSSSC_BUFF_LEN
);

2406 ià(
	`b£of
 (
s
)) {

2407 ià((
»t
 = 
	`cb
 (
·rm
, 
p
, 
buff
)) > 0)„et = 0;

2414 
	`bde¡roy
 (
buff
);

2415  
»t
;

2416 
	}
}

2422 
b¡rLi¡
 * 
	$b¡rLi¡C»©e
 () {

2423 
b¡rLi¡
 * 
¦
 = (b¡rLi¡ *è
	`b¡r__®loc
 ( (bstrList));

2424 ià(
¦
) {

2425 
¦
->
’Œy
 = (
b¡ršg
 *è
	`b¡r__®loc
 (1* (bstring));

2426 ià(!
¦
->
’Œy
) {

2427 
	`b¡r__ä“
 (
¦
);

2428 
¦
 = 
NULL
;

2430 
¦
->
qty
 = 0;

2431 
¦
->
mËn
 = 1;

2434  
¦
;

2435 
	}
}

2441 
	$b¡rLi¡De¡roy
 (
b¡rLi¡
 * 
¦
) {

2442 
i
;

2443 ià(
¦
 =ð
NULL
 || sl->
qty
 < 0è 
BSTR_ERR
;

2444 
i
=0; i < 
¦
->
qty
; i++) {

2445 ià(
¦
->
’Œy
[
i
]) {

2446 
	`bde¡roy
 (
¦
->
’Œy
[
i
]);

2447 
¦
->
’Œy
[
i
] = 
NULL
;

2450 
¦
->
qty
 = -1;

2451 
¦
->
mËn
 = -1;

2452 
	`b¡r__ä“
 (
¦
->
’Œy
);

2453 
¦
->
’Œy
 = 
NULL
;

2454 
	`b¡r__ä“
 (
¦
);

2455  
BSTR_OK
;

2456 
	}
}

2463 
	$b¡rLi¡AÎoc
 (
b¡rLi¡
 * 
¦
, 
msz
) {

2464 
b¡ršg
 * 
l
;

2465 
smsz
;

2466 
size_t
 
nsz
;

2467 ià(!
¦
 || 
msz
 <ð0 || !¦->
’Œy
 || sl->
qty
 < 0 || sl->
mËn
 <ð0 || sl->qty > sl->mËnè 
BSTR_ERR
;

2468 ià(
¦
->
mËn
 >ð
msz
è 
BSTR_OK
;

2469 
smsz
 = 
	`¢­UpSize
 (
msz
);

2470 
nsz
 = ((
size_t
è
smsz
è*  (
b¡ršg
);

2471 ià(
nsz
 < (
size_t
è
smsz
è 
BSTR_ERR
;

2472 
l
 = (
b¡ršg
 *è
	`b¡r__»®loc
 (
¦
->
’Œy
, 
nsz
);

2473 ià(!
l
) {

2474 
smsz
 = 
msz
;

2475 
nsz
 = ((
size_t
è
smsz
è*  (
b¡ršg
);

2476 
l
 = (
b¡ršg
 *è
	`b¡r__»®loc
 (
¦
->
’Œy
, 
nsz
);

2477 ià(!
l
è 
BSTR_ERR
;

2479 
¦
->
mËn
 = 
smsz
;

2480 
¦
->
’Œy
 = 
l
;

2481  
BSTR_OK
;

2482 
	}
}

2489 
	$b¡rLi¡AÎocMš
 (
b¡rLi¡
 * 
¦
, 
msz
) {

2490 
b¡ršg
 * 
l
;

2491 
size_t
 
nsz
;

2492 ià(!
¦
 || 
msz
 <ð0 || !¦->
’Œy
 || sl->
qty
 < 0 || sl->
mËn
 <ð0 || sl->qty > sl->mËnè 
BSTR_ERR
;

2493 ià(
msz
 < 
¦
->
qty
) msz = sl->qty;

2494 ià(
¦
->
mËn
 =ð
msz
è 
BSTR_OK
;

2495 
nsz
 = ((
size_t
è
msz
è*  (
b¡ršg
);

2496 ià(
nsz
 < (
size_t
è
msz
è 
BSTR_ERR
;

2497 
l
 = (
b¡ršg
 *è
	`b¡r__»®loc
 (
¦
->
’Œy
, 
nsz
);

2498 ià(!
l
è 
BSTR_ERR
;

2499 
¦
->
mËn
 = 
msz
;

2500 
¦
->
’Œy
 = 
l
;

2501  
BSTR_OK
;

2502 
	}
}

2519 
b¥l™cb
 (
cÚ¡_b¡ršg
 
¡r
, 
¥l™Ch¬
, 
pos
,

2520 (* 
cb
è(* 
·rm
, 
ofs
, 
Ën
), *…arm) {

2521 
i
, 
p
, 
»t
;

2523 ià(
cb
 =ð
NULL
 || 
¡r
 =ðNULL || 
pos
 < 0 ||…o > sŒ->
¦’
)

2524  
BSTR_ERR
;

2526 
p
 = 
pos
;

2528 
i
=
p
; i < 
¡r
->
¦’
; i++) {

2529 ià(
¡r
->
d©a
[
i
] =ð
¥l™Ch¬
) ;

2531 ià((
»t
 = 
	`cb
 (
·rm
, 
p
, 
i
 -…)) < 0) „et;

2532 
p
 = 
i
 + 1;

2533 } 
p
 <ð
¡r
->
¦’
);

2534  
BSTR_OK
;

2535 
	}
}

2553 
b¥l™scb
 (
cÚ¡_b¡ršg
 
¡r
, cÚ¡_b¡ršg 
¥l™SŒ
, 
pos
,

2554 (* 
cb
è(* 
·rm
, 
ofs
, 
Ën
), *…arm) {

2555 
ch¬F›ld
 
chrs
;

2556 
i
, 
p
, 
»t
;

2558 ià(
cb
 =ð
NULL
 || 
¡r
 =ðNULL || 
pos
 < 0 ||…o > sŒ->
¦’


2559 || 
¥l™SŒ
 =ð
NULL
 || s¶™SŒ->
¦’
 < 0è 
BSTR_ERR
;

2560 ià(
¥l™SŒ
->
¦’
 == 0) {

2561 ià((
»t
 = 
	`cb
 (
·rm
, 0, 
¡r
->
¦’
)) > 0)„et = 0;

2562  
»t
;

2565 ià(
¥l™SŒ
->
¦’
 == 1)

2566  
	`b¥l™cb
 (
¡r
, 
¥l™SŒ
->
d©a
[0], 
pos
, 
cb
, 
·rm
);

2568 
	`buždCh¬F›ld
 (&
chrs
, 
¥l™SŒ
);

2570 
p
 = 
pos
;

2572 
i
=
p
; i < 
¡r
->
¦’
; i++) {

2573 ià(
	`‹¡InCh¬F›ld
 (&
chrs
, 
¡r
->
d©a
[
i
])) ;

2575 ià((
»t
 = 
	`cb
 (
·rm
, 
p
, 
i
 -…)) < 0) „et;

2576 
p
 = 
i
 + 1;

2577 } 
p
 <ð
¡r
->
¦’
);

2578  
BSTR_OK
;

2579 
	}
}

2597 
b¥l™¡rcb
 (
cÚ¡_b¡ršg
 
¡r
, cÚ¡_b¡ršg 
¥l™SŒ
, 
pos
,

2598 (* 
cb
è(* 
·rm
, 
ofs
, 
Ën
), *…arm) {

2599 
i
, 
p
, 
»t
;

2601 ià(
cb
 =ð
NULL
 || 
¡r
 =ðNULL || 
pos
 < 0 ||…o > sŒ->
¦’


2602 || 
¥l™SŒ
 =ð
NULL
 || s¶™SŒ->
¦’
 < 0è 
BSTR_ERR
;

2604 ià(0 =ð
¥l™SŒ
->
¦’
) {

2605 
i
=
pos
; i < 
¡r
->
¦’
; i++) {

2606 ià((
»t
 = 
	`cb
 (
·rm
, 
i
, 1)) < 0) „et;

2608  
BSTR_OK
;

2611 ià(
¥l™SŒ
->
¦’
 == 1)

2612  
	`b¥l™cb
 (
¡r
, 
¥l™SŒ
->
d©a
[0], 
pos
, 
cb
, 
·rm
);

2614 
i
=
p
=
pos
; i <ð
¡r
->
¦’
 - 
¥l™SŒ
->slen; i++) {

2615 ià(0 =ð
	`b¡r__memcmp
 (
¥l™SŒ
->
d©a
, 
¡r
->d©¨+ 
i
, s¶™SŒ->
¦’
)) {

2616 ià((
»t
 = 
	`cb
 (
·rm
, 
p
, 
i
 -…)) < 0) „et;

2617 
i
 +ð
¥l™SŒ
->
¦’
;

2618 
p
 = 
i
;

2621 ià((
»t
 = 
	`cb
 (
·rm
, 
p
, 
¡r
->
¦’
 -…)) < 0) „et;

2622  
BSTR_OK
;

2623 
	}
}

2625 
	sg’B¡rLi¡
 {

2626 
b¡ršg
 
	mb
;

2627 
b¡rLi¡
 * 
	mbl
;

2630 
	$bscb
 (* 
·rm
, 
ofs
, 
Ën
) {

2631 
g’B¡rLi¡
 * 
g
 = (g’B¡rLi¡ *è
·rm
;

2632 ià(
g
->
bl
->
qty
 >ðg->bl->
mËn
) {

2633 
mËn
 = 
g
->
bl
->mlen * 2;

2634 
b¡ršg
 * 
tbl
;

2636 
g
->
bl
->
qty
 >ð
mËn
) {

2637 ià(
mËn
 < 
g
->
bl
->mËnè 
BSTR_ERR
;

2638 
mËn
 += mlen;

2641 
tbl
 = (
b¡ršg
 *è
	`b¡r__»®loc
 (
g
->
bl
->
’Œy
,  (b¡ršgè* 
mËn
);

2642 ià(
tbl
 =ð
NULL
è 
BSTR_ERR
;

2644 
g
->
bl
->
’Œy
 = 
tbl
;

2645 
g
->
bl
->
mËn
 = mlen;

2648 
g
->
bl
->
’Œy
[g->bl->
qty
] = 
	`bmid¡r
 (g->
b
, 
ofs
, 
Ën
);

2649 
g
->
bl
->
qty
++;

2650  
BSTR_OK
;

2651 
	}
}

2658 
b¡rLi¡
 * 
	$b¥l™
 (
cÚ¡_b¡ršg
 
¡r
, 
¥l™Ch¬
) {

2659 
g’B¡rLi¡
 
g
;

2661 ià(
¡r
 =ð
NULL
 || sŒ->
d©a
 =ðNULL || sŒ->
¦’
 < 0)  NULL;

2663 
g
.
bl
 = (
b¡rLi¡
 *è
	`b¡r__®loc
 ( (bstrList));

2664 ià(
g
.
bl
 =ð
NULL
)  NULL;

2665 
g
.
bl
->
mËn
 = 4;

2666 
g
.
bl
->
’Œy
 = (
b¡ršg
 *è
	`b¡r__®loc
 (g.bl->
mËn
 *  (bstring));

2667 ià(
NULL
 =ð
g
.
bl
->
’Œy
) {

2668 
	`b¡r__ä“
 (
g
.
bl
);

2669  
NULL
;

2672 
g
.
b
 = (
b¡ršg
è
¡r
;

2673 
g
.
bl
->
qty
 = 0;

2674 ià(
	`b¥l™cb
 (
¡r
, 
¥l™Ch¬
, 0, 
bscb
, &
g
) < 0) {

2675 
	`b¡rLi¡De¡roy
 (
g
.
bl
);

2676  
NULL
;

2678  
g
.
bl
;

2679 
	}
}

2686 
b¡rLi¡
 * 
	$b¥l™¡r
 (
cÚ¡_b¡ršg
 
¡r
, cÚ¡_b¡ršg 
¥l™SŒ
) {

2687 
g’B¡rLi¡
 
g
;

2689 ià(
¡r
 =ð
NULL
 || sŒ->
d©a
 =ðNULL || sŒ->
¦’
 < 0)  NULL;

2691 
g
.
bl
 = (
b¡rLi¡
 *è
	`b¡r__®loc
 ( (bstrList));

2692 ià(
g
.
bl
 =ð
NULL
)  NULL;

2693 
g
.
bl
->
mËn
 = 4;

2694 
g
.
bl
->
’Œy
 = (
b¡ršg
 *è
	`b¡r__®loc
 (g.bl->
mËn
 *  (bstring));

2695 ià(
NULL
 =ð
g
.
bl
->
’Œy
) {

2696 
	`b¡r__ä“
 (
g
.
bl
);

2697  
NULL
;

2700 
g
.
b
 = (
b¡ršg
è
¡r
;

2701 
g
.
bl
->
qty
 = 0;

2702 ià(
	`b¥l™¡rcb
 (
¡r
, 
¥l™SŒ
, 0, 
bscb
, &
g
) < 0) {

2703 
	`b¡rLi¡De¡roy
 (
g
.
bl
);

2704  
NULL
;

2706  
g
.
bl
;

2707 
	}
}

2715 
b¡rLi¡
 * 
	$b¥l™s
 (
cÚ¡_b¡ršg
 
¡r
, cÚ¡_b¡ršg 
¥l™SŒ
) {

2716 
g’B¡rLi¡
 
g
;

2718 iàÐ
¡r
 =ð
NULL
 || sŒ->
¦’
 < 0 || sŒ->
d©a
 == NULL ||

2719 
¥l™SŒ
 =ð
NULL
 || s¶™SŒ->
¦’
 < 0 || s¶™SŒ->
d©a
 == NULL)

2720  
NULL
;

2722 
g
.
bl
 = (
b¡rLi¡
 *è
	`b¡r__®loc
 ( (bstrList));

2723 ià(
g
.
bl
 =ð
NULL
)  NULL;

2724 
g
.
bl
->
mËn
 = 4;

2725 
g
.
bl
->
’Œy
 = (
b¡ršg
 *è
	`b¡r__®loc
 (g.bl->
mËn
 *  (bstring));

2726 ià(
NULL
 =ð
g
.
bl
->
’Œy
) {

2727 
	`b¡r__ä“
 (
g
.
bl
);

2728  
NULL
;

2730 
g
.
b
 = (
b¡ršg
è
¡r
;

2731 
g
.
bl
->
qty
 = 0;

2733 ià(
	`b¥l™scb
 (
¡r
, 
¥l™SŒ
, 0, 
bscb
, &
g
) < 0) {

2734 
	`b¡rLi¡De¡roy
 (
g
.
bl
);

2735  
NULL
;

2737  
g
.
bl
;

2738 
	}
}

2740 #ià
defšed
 (
__TURBOC__
è&& !defšed (
__BORLANDC__
)

2741 #iâdeà
BSTRLIB_NOVSNP


2742 
	#BSTRLIB_NOVSNP


	)

2747 #ià
defšed
(
__WATCOMC__
è|| defšed(
_MSC_VER
)

2748 
	#exv¢´štf
(
r
,
b
,
n
,
f
,
a
è{¸ð
	`_v¢´štf
 (b,n,f,a);}

	)

2750 #ifdeà
BSTRLIB_NOVSNP


2753 
	#exv¢´štf
(
r
,
b
,
n
,
f
,
a
è{
	`v¥rštf
 (b,f,a);„ = -1;}

	)

2754 
	#START_VSNBUFF
 (256)

	)

2757 #ià
defšed
(
__GNUC__
è&& !defšed(
__APPLE__
)

2760 
v¢´štf
 (*
buf
, 
size_t
 
couÁ
, cÚ¡ *
fÜm©
, 
va_li¡
 
¬g
);

2763 
	#exv¢´štf
(
r
,
b
,
n
,
f
,
a
è{¸ð
	`v¢´štf
 (b,n,f,a);}

	)

2767 #ià!
defšed
 (
BSTRLIB_NOVSNP
)

2769 #iâdeà
START_VSNBUFF


2770 
	#START_VSNBUFF
 (16)

	)

2788 
	$bfÜm©a
 (
b¡ršg
 
b
, cÚ¡ * 
fmt
, ...) {

2789 
va_li¡
 
¬gli¡
;

2790 
b¡ršg
 
buff
;

2791 
n
, 
r
;

2793 ià(
b
 =ð
NULL
 || 
fmt
 =ðNULL || b->
d©a
 =ðNULL || b->
mËn
 <= 0

2794 || 
b
->
¦’
 < 0 || b->¦’ > b->
mËn
è 
BSTR_ERR
;

2800 ià((
n
 = (è(2*
	`¡¾’
 (
fmt
))è< 
START_VSNBUFF
)‚ = START_VSNBUFF;

2801 ià(
NULL
 =ð(
buff
 = 
	`bäomc¡¿Îoc
 (
n
 + 2, ""))) {

2802 
n
 = 1;

2803 ià(
NULL
 =ð(
buff
 = 
	`bäomc¡¿Îoc
 (
n
 + 2, ""))è 
BSTR_ERR
;

2807 
	`va_¡¬t
 (
¬gli¡
, 
fmt
);

2808 
	`exv¢´štf
 (
r
, (*è
buff
->
d©a
, 
n
 + 1, 
fmt
, 
¬gli¡
);

2809 
	`va_’d
 (
¬gli¡
);

2811 
buff
->
d©a
[
n
] = () '\0';

2812 
buff
->
¦’
 = (è(
¡¾’
è((*èbuff->
d©a
);

2814 ià(
buff
->
¦’
 < 
n
) ;

2816 ià(
r
 > 
n
)‚ =„; n +=‚;

2818 ià(
BSTR_OK
 !ð
	`b®loc
 (
buff
, 
n
 + 2)) {

2819 
	`bde¡roy
 (
buff
);

2820  
BSTR_ERR
;

2824 
r
 = 
	`bcÚÿt
 (
b
, 
buff
);

2825 
	`bde¡roy
 (
buff
);

2826  
r
;

2827 
	}
}

2836 
	$bassignfÜm©
 (
b¡ršg
 
b
, cÚ¡ * 
fmt
, ...) {

2837 
va_li¡
 
¬gli¡
;

2838 
b¡ršg
 
buff
;

2839 
n
, 
r
;

2841 ià(
b
 =ð
NULL
 || 
fmt
 =ðNULL || b->
d©a
 =ðNULL || b->
mËn
 <= 0

2842 || 
b
->
¦’
 < 0 || b->¦’ > b->
mËn
è 
BSTR_ERR
;

2848 ià((
n
 = (è(2*
	`¡¾’
 (
fmt
))è< 
START_VSNBUFF
)‚ = START_VSNBUFF;

2849 ià(
NULL
 =ð(
buff
 = 
	`bäomc¡¿Îoc
 (
n
 + 2, ""))) {

2850 
n
 = 1;

2851 ià(
NULL
 =ð(
buff
 = 
	`bäomc¡¿Îoc
 (
n
 + 2, ""))è 
BSTR_ERR
;

2855 
	`va_¡¬t
 (
¬gli¡
, 
fmt
);

2856 
	`exv¢´štf
 (
r
, (*è
buff
->
d©a
, 
n
 + 1, 
fmt
, 
¬gli¡
);

2857 
	`va_’d
 (
¬gli¡
);

2859 
buff
->
d©a
[
n
] = () '\0';

2860 
buff
->
¦’
 = (è(
¡¾’
è((*èbuff->
d©a
);

2862 ià(
buff
->
¦’
 < 
n
) ;

2864 ià(
r
 > 
n
)‚ =„; n +=‚;

2866 ià(
BSTR_OK
 !ð
	`b®loc
 (
buff
, 
n
 + 2)) {

2867 
	`bde¡roy
 (
buff
);

2868  
BSTR_ERR
;

2872 
r
 = 
	`bassign
 (
b
, 
buff
);

2873 
	`bde¡roy
 (
buff
);

2874  
r
;

2875 
	}
}

2884 
b¡ršg
 
	$bfÜm©
 (cÚ¡ * 
fmt
, ...) {

2885 
va_li¡
 
¬gli¡
;

2886 
b¡ršg
 
buff
;

2887 
n
, 
r
;

2889 ià(
fmt
 =ð
NULL
)  NULL;

2895 ià((
n
 = (è(2*
	`¡¾’
 (
fmt
))è< 
START_VSNBUFF
)‚ = START_VSNBUFF;

2896 ià(
NULL
 =ð(
buff
 = 
	`bäomc¡¿Îoc
 (
n
 + 2, ""))) {

2897 
n
 = 1;

2898 ià(
NULL
 =ð(
buff
 = 
	`bäomc¡¿Îoc
 (
n
 + 2, "")))  NULL;

2902 
	`va_¡¬t
 (
¬gli¡
, 
fmt
);

2903 
	`exv¢´štf
 (
r
, (*è
buff
->
d©a
, 
n
 + 1, 
fmt
, 
¬gli¡
);

2904 
	`va_’d
 (
¬gli¡
);

2906 
buff
->
d©a
[
n
] = () '\0';

2907 
buff
->
¦’
 = (è(
¡¾’
è((*èbuff->
d©a
);

2909 ià(
buff
->
¦’
 < 
n
) ;

2911 ià(
r
 > 
n
)‚ =„; n +=‚;

2913 ià(
BSTR_OK
 !ð
	`b®loc
 (
buff
, 
n
 + 2)) {

2914 
	`bde¡roy
 (
buff
);

2915  
NULL
;

2919  
buff
;

2920 
	}
}

2942 
	$bvcfÜm©a
 (
b¡ršg
 
b
, 
couÁ
, cÚ¡ * 
fmt
, 
va_li¡
 
¬g
) {

2943 
n
, 
r
, 
l
;

2945 ià(
b
 =ð
NULL
 || 
fmt
 =ðNULL || 
couÁ
 <ð0 || b->
d©a
 == NULL

2946 || 
b
->
mËn
 <ð0 || b->
¦’
 < 0 || b->¦’ > b->mËnè 
BSTR_ERR
;

2948 ià(
couÁ
 > (
n
 = 
b
->
¦’
 + couÁè+ 2è 
BSTR_ERR
;

2949 ià(
BSTR_OK
 !ð
	`b®loc
 (
b
, 
n
 + 2)è 
BSTR_ERR
;

2951 
	`exv¢´štf
 (
r
, (*è
b
->
d©a
 + b->
¦’
, 
couÁ
 + 2, 
fmt
, 
¬g
);

2955 ià(
n
 >ð(
l
 = 
b
->
¦’
 + (è(
¡¾’
è((cÚ¡ *èb->
d©a
 + b->slen))) {

2956 
b
->
¦’
 = 
l
;

2957  
BSTR_OK
;

2963 
b
->
d©a
[b->
¦’
] = '\0';

2964 ià(
r
 > 
couÁ
+1è
l
 =„; {

2965 
l
 = 
couÁ
+count;

2966 ià(
couÁ
 > 
l
èÈð
INT_MAX
;

2968 
n
 = -
l
;

2969 ià(
n
 > 
BSTR_ERR
-1)‚ = BSTR_ERR-1;

2970  
n
;

2971 
	}
}

	@src/lcthw/bstrlib.h

14 #iâdeà
BSTRLIB_INCLUDE


15 
	#BSTRLIB_INCLUDE


	)

17 #ifdeà
__ýlu¥lus


21 
	~<¡d¬g.h
>

22 
	~<¡ršg.h
>

23 
	~<lim™s.h
>

24 
	~<ùy³.h
>

26 #ià!
defšed
 (
BSTRLIB_VSNP_OK
è&& !defšed (
BSTRLIB_NOVSNP
)

27 #ià
defšed
 (
__TURBOC__
è&& !defšed (
__BORLANDC__
)

28 
	#BSTRLIB_NOVSNP


	)

32 
	#BSTR_ERR
 (-1)

	)

33 
	#BSTR_OK
 (0)

	)

34 
	#BSTR_BS_BUFF_LENGTH_GET
 (0)

	)

36 
gb¡ršg
 * 
	tb¡ršg
;

37 cÚ¡ 
	tgb¡ršg
 * 
	tcÚ¡_b¡ršg
;

40 
	#c¡r2b¡r
 
bäomc¡r


	)

41 
b¡ršg
 
bäomc¡r
 (cÚ¡ * 
¡r
);

42 
b¡ršg
 
bäomc¡¿Îoc
 (
mËn
, cÚ¡ * 
¡r
);

43 
b¡ršg
 
blk2b¡r
 (cÚ¡ * 
blk
, 
Ën
);

44 * 
b¡r2c¡r
 (
cÚ¡_b¡ršg
 
s
, 
z
);

45 
bc¡rä“
 (* 
s
);

46 
b¡ršg
 
b¡rýy
 (
cÚ¡_b¡ršg
 
b1
);

47 
bassign
 (
b¡ršg
 
a
, 
cÚ¡_b¡ršg
 
b
);

48 
bassignmid¡r
 (
b¡ršg
 
a
, 
cÚ¡_b¡ršg
 
b
, 
Ëá
, 
Ën
);

49 
bassignc¡r
 (
b¡ršg
 
a
, cÚ¡ * 
¡r
);

50 
bassignblk
 (
b¡ršg
 
a
, cÚ¡ * 
s
, 
Ën
);

53 
bde¡roy
 (
b¡ršg
 
b
);

56 
b®loc
 (
b¡ršg
 
s
, 
Ën
);

57 
b®locmš
 (
b¡ršg
 
b
, 
Ën
);

60 
b¡ršg
 
bmid¡r
 (
cÚ¡_b¡ršg
 
b
, 
Ëá
, 
Ën
);

63 
bcÚÿt
 (
b¡ršg
 
b0
, 
cÚ¡_b¡ršg
 
b1
);

64 
bcÚch¬
 (
b¡ršg
 
b0
, 
c
);

65 
bÿtc¡r
 (
b¡ršg
 
b
, cÚ¡ * 
s
);

66 
bÿtblk
 (
b¡ršg
 
b
, cÚ¡ * 
s
, 
Ën
);

67 
bš£¹
 (
b¡ršg
 
s1
, 
pos
, 
cÚ¡_b¡ršg
 
s2
, 
fžl
);

68 
bš£¹ch
 (
b¡ršg
 
s1
, 
pos
, 
Ën
, 
fžl
);

69 
b»¶aû
 (
b¡ršg
 
b1
, 
pos
, 
Ën
, 
cÚ¡_b¡ršg
 
b2
, 
fžl
);

70 
bd–‘e
 (
b¡ršg
 
s1
, 
pos
, 
Ën
);

71 
b£t¡r
 (
b¡ršg
 
b0
, 
pos
, 
cÚ¡_b¡ršg
 
b1
, 
fžl
);

72 
bŒunc
 (
b¡ršg
 
b
, 
n
);

75 
b¡ricmp
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡_b¡ršg 
b1
);

76 
b¡ºicmp
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡_b¡ršg 
b1
, 
n
);

77 
bi£qÿ£Ëss
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡_b¡ršg 
b1
);

78 
bis¡emeqÿ£Ëssblk
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡ * 
blk
, 
Ën
);

79 
bi£q
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡_b¡ršg 
b1
);

80 
bis¡emeqblk
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡ * 
blk
, 
Ën
);

81 
bi£qc¡r
 (
cÚ¡_b¡ršg
 
b
, cÚ¡ * 
s
);

82 
bi£qc¡rÿ£Ëss
 (
cÚ¡_b¡ršg
 
b
, cÚ¡ * 
s
);

83 
b¡rcmp
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡_b¡ršg 
b1
);

84 
b¡ºcmp
 (
cÚ¡_b¡ršg
 
b0
, cÚ¡_b¡ršg 
b1
, 
n
);

85 
bš¡r
 (
cÚ¡_b¡ršg
 
s1
, 
pos
, cÚ¡_b¡ršg 
s2
);

86 
bš¡¼
 (
cÚ¡_b¡ršg
 
s1
, 
pos
, cÚ¡_b¡ršg 
s2
);

87 
bš¡rÿ£Ëss
 (
cÚ¡_b¡ršg
 
s1
, 
pos
, cÚ¡_b¡ršg 
s2
);

88 
bš¡¼ÿ£Ëss
 (
cÚ¡_b¡ršg
 
s1
, 
pos
, cÚ¡_b¡ršg 
s2
);

89 
b¡rch½
 (
cÚ¡_b¡ršg
 
b
, 
c
, 
pos
);

90 
b¡¼ch½
 (
cÚ¡_b¡ršg
 
b
, 
c
, 
pos
);

91 
	#b¡rchr
(
b
,
c
è
	`b¡rch½
 ((b), (c), 0)

	)

92 
	#b¡¼chr
(
b
,
c
è
	`b¡¼ch½
 ((b), (c), 
	`bËngth
(b)-1)

	)

93 
bšchr
 (
cÚ¡_b¡ršg
 
b0
, 
pos
, cÚ¡_b¡ršg 
b1
);

94 
bšch¼
 (
cÚ¡_b¡ršg
 
b0
, 
pos
, cÚ¡_b¡ršg 
b1
);

95 
bnšchr
 (
cÚ¡_b¡ršg
 
b0
, 
pos
, cÚ¡_b¡ršg 
b1
);

96 
bnšch¼
 (
cÚ¡_b¡ršg
 
b0
, 
pos
, cÚ¡_b¡ršg 
b1
);

97 
bfšd»¶aû
 (
b¡ršg
 
b
, 
cÚ¡_b¡ršg
 
fšd
, cÚ¡_b¡ršg 
»¶
, 
pos
);

98 
bfšd»¶aûÿ£Ëss
 (
b¡ršg
 
b
, 
cÚ¡_b¡ršg
 
fšd
, cÚ¡_b¡ršg 
»¶
, 
pos
);

101 
	sb¡rLi¡
 {

102 
	gqty
, 
	gmËn
;

103 
b¡ršg
 * 
	g’Œy
;

105 
b¡rLi¡
 * 
b¡rLi¡C»©e
 ();

106 
b¡rLi¡De¡roy
 (
b¡rLi¡
 * 
¦
);

107 
b¡rLi¡AÎoc
 (
b¡rLi¡
 * 
¦
, 
msz
);

108 
b¡rLi¡AÎocMš
 (
b¡rLi¡
 * 
¦
, 
msz
);

111 
b¡rLi¡
 * 
b¥l™
 (
cÚ¡_b¡ršg
 
¡r
, 
¥l™Ch¬
);

112 
b¡rLi¡
 * 
b¥l™s
 (
cÚ¡_b¡ršg
 
¡r
, cÚ¡_b¡ršg 
¥l™SŒ
);

113 
b¡rLi¡
 * 
b¥l™¡r
 (
cÚ¡_b¡ršg
 
¡r
, cÚ¡_b¡ršg 
¥l™SŒ
);

114 
b¡ršg
 
bjoš
 (cÚ¡ 
b¡rLi¡
 * 
bl
, 
cÚ¡_b¡ršg
 
£p
);

115 
b¥l™cb
 (
cÚ¡_b¡ršg
 
¡r
, 
¥l™Ch¬
, 
pos
,

116 (* 
cb
è(* 
·rm
, 
ofs
, 
Ën
), *…arm);

117 
b¥l™scb
 (
cÚ¡_b¡ršg
 
¡r
, cÚ¡_b¡ršg 
¥l™SŒ
, 
pos
,

118 (* 
cb
è(* 
·rm
, 
ofs
, 
Ën
), *…arm);

119 
b¥l™¡rcb
 (
cÚ¡_b¡ršg
 
¡r
, cÚ¡_b¡ršg 
¥l™SŒ
, 
pos
,

120 (* 
cb
è(* 
·rm
, 
ofs
, 
Ën
), *…arm);

123 
b·‰”n
 (
b¡ršg
 
b
, 
Ën
);

124 
btouµ”
 (
b¡ršg
 
b
);

125 
btÞow”
 (
b¡ršg
 
b
);

126 
bÉrimws
 (
b¡ršg
 
b
);

127 
b¹rimws
 (
b¡ršg
 
b
);

128 
bŒimws
 (
b¡ršg
 
b
);

130 #ià!
defšed
 (
BSTRLIB_NOVSNP
)

131 
b¡ršg
 
bfÜm©
 (cÚ¡ * 
fmt
, ...);

132 
bfÜm©a
 (
b¡ršg
 
b
, cÚ¡ * 
fmt
, ...);

133 
bassignfÜm©
 (
b¡ršg
 
b
, cÚ¡ * 
fmt
, ...);

134 
bvcfÜm©a
 (
b¡ršg
 
b
, 
couÁ
, cÚ¡ * 
fmt
, 
va_li¡
 
¬gli¡
);

136 
	#bvfÜm©a
(
»t
, 
b
, 
fmt
, 
Ï¡¬g
) { \

137 
b¡ršg
 
b¡¹mp_b
 = (
b
); \

138 cÚ¡ * 
b¡¹mp_fmt
 = (
fmt
); \

139 
b¡¹mp_r
 = 
BSTR_ERR
, 
b¡¹mp_sz
 = 16; \

141 
va_li¡
 
b¡¹mp_¬gli¡
; \

142 
	`va_¡¬t
 (
b¡¹mp_¬gli¡
, 
Ï¡¬g
); \

143 
b¡¹mp_r
 = 
	`bvcfÜm©a
 (
b¡¹mp_b
, 
b¡¹mp_sz
, 
b¡¹mp_fmt
, 
b¡¹mp_¬gli¡
); \

144 
	`va_’d
 (
b¡¹mp_¬gli¡
); \

145 ià(
b¡¹mp_r
 >= 0) { \

146 
b¡¹mp_r
 = 
BSTR_OK
; \

148 } ià(-
b¡¹mp_r
 <ð
b¡¹mp_sz
) { \

149 
b¡¹mp_r
 = 
BSTR_ERR
; \

152 
b¡¹mp_sz
 = -
b¡¹mp_r
; \

154 
»t
 = 
b¡¹mp_r
; \

155 }

	)

159 (*
	gbNg‘c
è(*
	t·rm
);

160 
size_t
 (* 
	tbN»ad
è(*
	tbuff
, 
	tsize_t
 
	t–size
, size_ˆ
	tÃËm
, *
	t·rm
);

163 
b¡ršg
 
bg‘s
 (
bNg‘c
 
g‘cPŒ
, * 
·rm
, 
‹rmš©Ü
);

164 
b¡ršg
 
b»ad
 (
bN»ad
 
»adPŒ
, * 
·rm
);

165 
bg‘§
 (
b¡ršg
 
b
, 
bNg‘c
 
g‘cPŒ
, * 
·rm
, 
‹rmš©Ü
);

166 
bassigng‘s
 (
b¡ršg
 
b
, 
bNg‘c
 
g‘cPŒ
, * 
·rm
, 
‹rmš©Ü
);

167 
b»ada
 (
b¡ršg
 
b
, 
bN»ad
 
»adPŒ
, * 
·rm
);

170 
bSŒ—m
 * 
bsÝ’
 (
bN»ad
 
»adPŒ
, * 
·rm
);

171 * 
bsþo£
 (
bSŒ—m
 * 
s
);

172 
bsbufæ’gth
 (
bSŒ—m
 * 
s
, 
sz
);

173 
b¤—dÊ
 (
b¡ršg
 
b
, 
bSŒ—m
 * 
s
, 
‹rmš©Ü
);

174 
b¤—dÊs
 (
b¡ršg
 
r
, 
bSŒ—m
 * 
s
, 
cÚ¡_b¡ršg
 
‹rm
);

175 
b¤—d
 (
b¡ršg
 
b
, 
bSŒ—m
 * 
s
, 
n
);

176 
b¤—dÊa
 (
b¡ršg
 
b
, 
bSŒ—m
 * 
s
, 
‹rmš©Ü
);

177 
b¤—dÊ§
 (
b¡ršg
 
r
, 
bSŒ—m
 * 
s
, 
cÚ¡_b¡ršg
 
‹rm
);

178 
b¤—da
 (
b¡ršg
 
b
, 
bSŒ—m
 * 
s
, 
n
);

179 
bsuÄ—d
 (
bSŒ—m
 * 
s
, 
cÚ¡_b¡ršg
 
b
);

180 
b¥“k
 (
b¡ršg
 
r
, cÚ¡ 
bSŒ—m
 * 
s
);

181 
bs¥l™scb
 (
bSŒ—m
 * 
s
, 
cÚ¡_b¡ršg
 
¥l™SŒ
,

182 (* 
cb
è(* 
·rm
, 
ofs
, 
cÚ¡_b¡ršg
 
’Œy
), *…arm);

183 
bs¥l™¡rcb
 (
bSŒ—m
 * 
s
, 
cÚ¡_b¡ršg
 
¥l™SŒ
,

184 (* 
cb
è(* 
·rm
, 
ofs
, 
cÚ¡_b¡ršg
 
’Œy
), *…arm);

185 
b£of
 (cÚ¡ 
bSŒ—m
 * 
s
);

187 
	sgb¡ršg
 {

188 
	gmËn
;

189 
	g¦’
;

190 * 
	gd©a
;

194 
	#bËngthe
(
b
, 
e
è(((bè=ð(*)0 || (b)->
¦’
 < 0è? ()Óè: ((b)->¦’))

	)

195 
	#bËngth
(
b
è(
	`bËngthe
 ((b), 0))

	)

196 
	#bd©aof£
(
b
, 
o
, 
e
è(((bè=ð(*)0 || (b)->
d©a
 =ð(*)0è? (*)Óè: ((*)(b)->d©aè+ (o))

	)

197 
	#bd©aofs
(
b
, 
o
è(
	`bd©aof£
 ((b), (o), (*)0))

	)

198 
	#bd©«
(
b
, 
e
è(
	`bd©aof£
 (b, 0,ƒ))

	)

199 
	#bd©a
(
b
è(
	`bd©aofs
 (b, 0))

	)

200 
	#bch¬e
(
b
, 
p
, 
e
è(((()Õ)è< ()
	`bËngth
(b)è? ((b)->
d©a
[Õ)]è: (e))

	)

201 
	#bch¬
(
b
, 
p
è
	`bch¬e
 ((b), (p), '\0')

	)

204 
	#bsSticMËn
(
q
,
m
è{(m), (è(q)-1, (*è("" q "")}

	)

205 #ià
defšed
(
_MSC_VER
)

206 
	#bsStic
(
q
è
	`bsSticMËn
(q,-32)

	)

208 #iâdeà
bsStic


209 
	#bsStic
(
q
è
	`bsSticMËn
(q,-
__LINE__
)

	)

213 
	#bsSticBlkP¬ms
(
q
è((*)("" q "")), ((è(q)-1)

	)

216 
	#c¡r2tb¡r
 
btäomc¡r


	)

217 
	#btäomc¡r
(
t
,
s
) { \

218 (
t
).
d©a
 = (*è(
s
); \

219 (
t
).
¦’
 = (Ñ).
d©a
è? ((è(
¡¾’
) ((*)(t).data)) : 0; \

220 (
t
).
mËn
 = -1; \

221 }

	)

222 
	#blk2tb¡r
(
t
,
s
,
l
) { \

223 (
t
).
d©a
 = (*è(
s
); \

224 (
t
).
¦’
 = 
l
; \

225 (
t
).
mËn
 = -1; \

226 }

	)

227 
	#btäomblk
(
t
,
s
,
l
è
	`blk2tb¡r
Ñ,s,l)

	)

228 
	#bmid2tb¡r
(
t
,
b
,
p
,
l
) { \

229 
cÚ¡_b¡ršg
 
b¡¹mp_s
 = (
b
); \

230 ià(
b¡¹mp_s
 && b¡¹mp_s->
d©a
 && b¡¹mp_s->
¦’
 >= 0) { \

231 
b¡¹mp_Ëá
 = (
p
); \

232 
b¡¹mp_Ën
 = (
l
); \

233 ià(
b¡¹mp_Ëá
 < 0) { \

234 
b¡¹mp_Ën
 +ð
b¡¹mp_Ëá
; \

235 
b¡¹mp_Ëá
 = 0; \

237 ià(
b¡¹mp_Ën
 > 
b¡¹mp_s
->
¦’
 - 
b¡¹mp_Ëá
) \

238 
b¡¹mp_Ën
 = 
b¡¹mp_s
->
¦’
 - 
b¡¹mp_Ëá
; \

239 ià(
b¡¹mp_Ën
 <= 0) { \

240 (
t
).
d©a
 = (*)""; \

241 (
t
).
¦’
 = 0; \

243 (
t
).
d©a
 = 
b¡¹mp_s
->d©¨+ 
b¡¹mp_Ëá
; \

244 (
t
).
¦’
 = 
b¡¹mp_Ën
; \

247 (
t
).
d©a
 = (*)""; \

248 (
t
).
¦’
 = 0; \

250 (
t
).
mËn
 = -
__LINE__
; \

251 }

	)

252 
	#btäomblkÉrimws
(
t
,
s
,
l
) { \

253 
b¡¹mp_idx
 = 0, 
b¡¹mp_Ën
 = (
l
); \

254 * 
b¡¹mp_s
 = (
s
); \

255 ià(
b¡¹mp_s
 && 
b¡¹mp_Ën
 >= 0) { \

256 ; 
b¡¹mp_idx
 < 
b¡¹mp_Ën
; bstrtmp_idx++) { \

257 ià(!
	`is¥aû
 (
b¡¹mp_s
[
b¡¹mp_idx
])) ; \

260 (
t
).
d©a
 = 
b¡¹mp_s
 + 
b¡¹mp_idx
; \

261 (
t
).
¦’
 = 
b¡¹mp_Ën
 - 
b¡¹mp_idx
; \

262 (
t
).
mËn
 = -
__LINE__
; \

263 }

	)

264 
	#btäomblk¹rimws
(
t
,
s
,
l
) { \

265 
b¡¹mp_Ën
 = (
l
) - 1; \

266 * 
b¡¹mp_s
 = (
s
); \

267 ià(
b¡¹mp_s
 && 
b¡¹mp_Ën
 >= 0) { \

268 ; 
b¡¹mp_Ën
 >= 0; bstrtmp_len--) { \

269 ià(!
	`is¥aû
 (
b¡¹mp_s
[
b¡¹mp_Ën
])) ; \

272 (
t
).
d©a
 = 
b¡¹mp_s
; \

273 (
t
).
¦’
 = 
b¡¹mp_Ën
 + 1; \

274 (
t
).
mËn
 = -
__LINE__
; \

275 }

	)

276 
	#btäomblkŒimws
(
t
,
s
,
l
) { \

277 
b¡¹mp_idx
 = 0, 
b¡¹mp_Ën
 = (
l
) - 1; \

278 * 
b¡¹mp_s
 = (
s
); \

279 ià(
b¡¹mp_s
 && 
b¡¹mp_Ën
 >= 0) { \

280 ; 
b¡¹mp_idx
 <ð
b¡¹mp_Ën
; bstrtmp_idx++) { \

281 ià(!
	`is¥aû
 (
b¡¹mp_s
[
b¡¹mp_idx
])) ; \

283 ; 
b¡¹mp_Ën
 >ð
b¡¹mp_idx
; bstrtmp_len--) { \

284 ià(!
	`is¥aû
 (
b¡¹mp_s
[
b¡¹mp_Ën
])) ; \

287 (
t
).
d©a
 = 
b¡¹mp_s
 + 
b¡¹mp_idx
; \

288 (
t
).
¦’
 = 
b¡¹mp_Ën
 + 1 - 
b¡¹mp_idx
; \

289 (
t
).
mËn
 = -
__LINE__
; \

290 }

	)

293 
	#bwr™•rÙeù
(
t
è{ ià(Ñ).
mËn
 >ð0èÑ).mËÀð-1; }

	)

294 
	#bwr™—Îow
(
t
è{ ià(Ñ).
mËn
 =ð-1èÑ).mËÀðÑ).
¦’
 + (Ñ).¦’ =ð0); }

	)

295 
	#biswr™•rÙeùed
(
t
è(Ñ).
mËn
 <ð0)

	)

297 #ifdeà
__ýlu¥lus


	@src/lcthw/dbg.h

1 #iâdeà
__dbg_h__


2 
	#__dbg_h__


	)

4 
	~<¡dio.h
>

5 
	~<”ºo.h
>

6 
	~<¡ršg.h
>

26 #ifdeà
NDEBUG


27 
	#debug
(
M
 , ...)

	)

29 
	#debug
(
M
 , ...è
	`årštf
(
¡d”r
 , "DEBUG %s:%d " M "\n" , 
__FILE__
 ,\

30 
__LINE__
 , ##
__VA_ARGS__
)

	)

33 
	#þ—n_”ºo
(è(
”ºo
 =ð0 ? "NONE" : 
	`¡»¼Ü
Ó¼no))

	)

35 
	#log_”r
(
M
 , ...è
	`årštf
(
¡d”r
 , "(ERRORè%s:%d:”ºo: %sè" M "\n", 
__FILE__
 , 
__LINE__
 , 
	`þ—n_”ºo
(),##
__VA_ARGS__
)

	)

37 
	#log_w¬n
(
M
 , ...è
	`årštf
(
¡d”r
 , "(WARNè%s:%d:”ºo: %sè" M "\n", 
__FILE__
 , 
__LINE__
 , 
	`þ—n_”ºo
(),##
__VA_ARGS__
)

	)

39 
	#log_šfo
(
M
 , ...è
	`årštf
(
¡d”r
 , "(INFOè%s:%d:”ºo: %sè" M "\n", 
__FILE__
 , 
__LINE__
 , 
	`þ—n_”ºo
(),##
__VA_ARGS__
)

	)

41 
	#check
(
A
,
M
, ... ) if(!(A)è{
	`log_”r
(M , ##
__VA_ARGS__
);
”ºo
 = 0;
”rÜ
;}

	)

43 
	#£Áš–
(
M
 , ...è{
	`log_”r
(M , ##
__VA_ARGS__
);
”ºo
=0; 
”rÜ
;}

	)

45 
	#check_mem
(
A
è
	`check
((Aè, "ouˆoàmemeÜy")

	)

46 
	#check_debug
(
A
 , 
M
 , ...èif(!(A)è{
	`debug
(M, ##
__VA_ARGS__
);
”ºo
=0;
”rÜ
;}

	)

	@tests/BSTree_tests.c

1 
	~"mšun™.h
"

2 
	~<lùhw/BST»e.h
>

3 
	~<as£¹.h
>

4 
	~<lùhw/b¡¾ib.h
>

5 
	~<¡dlib.h
>

6 
	~<time.h
>

8 
BST»e
 *
	gm­
 = 
NULL
;

9 
	gŒav”£_ÿÎed
 = 0;

10 
gb¡ršg
 
	g‹¡1
 = 
bsStic
("test data 1");

11 
gb¡ršg
 
	g‹¡2
 = 
bsStic
("test data 2");

12 
gb¡ršg
 
	g‹¡3
 = 
bsStic
("test data 3");

13 
gb¡ršg
 
	gex³ù1
 = 
bsStic
("the value 1");

14 
gb¡ršg
 
	gex³ù2
 = 
bsStic
("the value 2");

15 
gb¡ršg
 
	gex³ù3
 = 
bsStic
("the value 3");

17 
	$Œav”£_good_cb
(
BST»eNode
 *
node
)

19 
	`debug
("key :%s" , 
	`bd©a
((
b¡ršg
)
node
->
key
));

20 
Œav”£_ÿÎed
++;

22 
	}
}

24 
	$Œav”£_çž_cb
(
BST»eNode
 *
node
)

26 
	`debug
("key: %s" , 
	`bd©a
((
b¡ršg
)
node
->
key
));

27 
Œav”£_ÿÎed
++;

29 if(
Œav”£_ÿÎed
 == 2 ){

34 
	}
}

36 *
	$‹¡_ü—‹
()

38 
m­
 = 
	`BST»e_ü—‹
(
NULL
);

39 
	`mu_as£¹
(
m­
!=
NULL
 , "failo create map");

41  
NULL
;

42 
	}
}

44 *
	$‹¡_de¡roy
()

46 
	`BST»e_de¡roy
(
m­
);

48  
NULL
;

49 
	}
}

51 *
	$‹¡_g‘_£t
()

53 
rc
ð
	`BST»e_£t
(
m­
 , &
‹¡1
 , &
ex³ù1
);

54 
	`mu_as£¹
(
rc
 == 0 , "failo set &test1");

55 
b¡ršg
 
»suÉ
 = 
	`BST»e_g‘
(
m­
 , &
‹¡1
);

56 
	`mu_as£¹
(
»suÉ
 =ð&
ex³ù1
 , "wrong value forest1");

58 
rc
ð
	`BST»e_£t
(
m­
 , &
‹¡2
 , &
ex³ù2
);

59 
	`mu_as£¹
(
rc
 == 0 , "failo set &test1");

60 
»suÉ
 = 
	`BST»e_g‘
(
m­
 , &
‹¡2
);

61 
	`mu_as£¹
(
»suÉ
 =ð&
ex³ù2
 , "wrong value forest1");

63 
rc
ð
	`BST»e_£t
(
m­
 , &
‹¡3
 , &
ex³ù3
);

64 
	`mu_as£¹
(
rc
 == 0 , "failo set &test1");

65 
»suÉ
 = 
	`BST»e_g‘
(
m­
 , &
‹¡3
);

66 
	`mu_as£¹
(
»suÉ
 =ð&
ex³ù3
 , "wrong value forest1");

68  
NULL
;

70 
	}
}

72 *
	$‹¡_Œav”£
()

74 
rc
 = 
	`BST»e_Œav”£
(
m­
 , 
Œav”£_good_cb
);

75 
	`mu_as£¹
(
rc
 == 0 , "failedoraverse");

76 
	`mu_as£¹
(
Œav”£_ÿÎed
 == 3 , "wrong countraverse");

78 
Œav”£_ÿÎed
 = 0;

79 
rc
 = 
	`BST»e_Œav”£
(
m­
 , 
Œav”£_çž_cb
);

80 
	`mu_as£¹
(
rc
 == 1 , "failedoraverse");

81 
	`mu_as£¹
(
Œav”£_ÿÎed
 == 2 , "wrong countraverse for fail");

83  
NULL
;

84 
	}
}

86 *
	$‹¡_d–‘e
()

88 
b¡ršg
 
d–‘ed
 = (b¡ršg)
	`BST»e_d–‘e
(
m­
 , &
‹¡1
);

89 
	`mu_as£¹
(
d–‘ed
 !ð
NULL
 , "got‚ull on delete");

90 
	`mu_as£¹
(
d–‘ed
 =ð&
ex³ù1
 , "should getest1");

91 
b¡ršg
 
»suÉ
 = 
	`BST»e_g‘
(
m­
 , &
‹¡1
);

92 
	`mu_as£¹
(
»suÉ
 =ð
NULL
 , "should deleted");

94 
d–‘ed
 = (
b¡ršg
)
	`BST»e_d–‘e
(
m­
 , &
‹¡1
);

95 
	`mu_as£¹
(
»suÉ
 =ð
NULL
 , "should get‚ull on delete");

97 
d–‘ed
 = (
b¡ršg
)
	`BST»e_d–‘e
(
m­
 , &
‹¡2
);

98 
	`mu_as£¹
(
d–‘ed
 !ð
NULL
 , "got‚ull on delete");

99 
	`mu_as£¹
(
d–‘ed
 =ð&
ex³ù2
 , "should getest2");

100 
»suÉ
 = 
	`BST»e_g‘
(
m­
 , &
‹¡2
);

101 
	`mu_as£¹
(
»suÉ
 =ð
NULL
 , "should deleted");

103 
d–‘ed
 = (
b¡ršg
)
	`BST»e_d–‘e
(
m­
 , &
‹¡2
);

104 
	`mu_as£¹
(
»suÉ
 =ð
NULL
 , "should get‚ull on delete");

106 
d–‘ed
 = (
b¡ršg
)
	`BST»e_d–‘e
(
m­
 , &
‹¡3
);

107 
	`mu_as£¹
(
d–‘ed
 !ð
NULL
 , "got‚ull on delete");

108 
	`mu_as£¹
(
d–‘ed
 =ð&
ex³ù3
 , "should getest3");

109 
»suÉ
 = 
	`BST»e_g‘
(
m­
 , &
‹¡3
);

110 
	`mu_as£¹
(
»suÉ
 =ð
NULL
 , "should deleted");

112 
d–‘ed
 = (
b¡ršg
)
	`BST»e_d–‘e
(
m­
 , &
‹¡3
);

113 
	`mu_as£¹
(
»suÉ
 =ð
NULL
 , "should get‚ull on delete");

116  
NULL
;

117 
	}
}

120 *
	$‹¡_fuzzšg
()

122 
BST»e
 *
¡Üe
 = 
	`BST»e_ü—‹
(
NULL
);

123 
i
 = 0;

124 
j
 = 0;

125 
b¡ršg
 
numb”s
[100] = {
NULL
};

126 
b¡ršg
 
d©a
[100] = {
NULL
};

127 
	`¤ªd
(()
	`time
(
NULL
));

129  
i
 = 0; i<100 ; i++){

130 
num
 = 
	`¿nd
();

131 
numb”s
[
i
] = 
	`bfÜm©
("%d" , 
num
 );

132 
d©a
[
i
] = 
	`bfÜm©
("d©¨%d " , 
num
 );

133 
	`BST»e_£t
(
¡Üe
 , 
numb”s
[
i
] ,
d©a
[i]);

136  
i
 = 0 ; i < 100 ; i++){

137 
b¡ršg
 
v®ue
 = 
	`BST»e_d–‘e
(
¡Üe
 , 
numb”s
[
i
]);

138 
	`mu_as£¹
(
v®ue
 =ð
d©a
[
i
] ,"failedo deletehe„ight‚umber");

139 
	`mu_as£¹
(
	`BST»e_d–‘e
(
¡Üe
 , 
numb”s
[
i
])==
NULL
 , "should get‚othing");

141  
j
 = 
i
+1 ; j < 99-i ; j++){

142 
b¡ršg
 
v®ue
 = 
	`BST»e_g‘
(
¡Üe
 , 
numb”s
[
j
]); 
	`mu_as£¹
(v®u=ð
d©a
[j] , "failedo gethe„ight‚umbers");

144 
	`bde¡roy
(
v®ue
);

145 
	`bde¡roy
(
numb”s
[
i
]);

148 
	`BST»e_de¡roy
(
¡Üe
);

149  
NULL
;

150 
	}
}

153 *
	$®l_‹¡s
()

155 
	`mu_su™e_¡¬t
();

157 
	`mu_run_‹¡
(
‹¡_ü—‹
);

158 
	`mu_run_‹¡
(
‹¡_g‘_£t
);

159 
	`mu_run_‹¡
(
‹¡_Œav”£
);

160 
	`mu_run_‹¡
(
‹¡_d–‘e
);

161 
	`mu_run_‹¡
(
‹¡_de¡roy
);

162 
	`mu_run_‹¡
(
‹¡_fuzzšg
);

163  
NULL
;

164 
	}
}

166 
RUN_TESTS
(
®l_‹¡s
);

	@tests/minunit.h

1 #undeà
NDEBUG


2 #iâdeà
_mšun™_h


3 
	#_mšun™_h


	)

5 
	~<¡dio.h
>

6 
	~<lùhw/dbg.h
>

7 
	~<¡dlib.h
>

9 
	#mu_su™e_¡¬t
(è*
mes§ge
 = 
NULL


	)

11 
	#mu_as£¹
(
‹¡
 , 
mes§ge
èif(!Ñe¡)è{
	`log_”r
(mes§ge);  mes§ge;}

	)

12 
	#mu_run_‹¡
(
‹¡
è
	`debug
("\n------%s" , " "#test); \

13 
mes§ge
 = 
	`‹¡
(); 
‹¡s_run
++; if(mes§geè mes§ge;

	)

15 
	#RUN_TESTS
(
Çme
è
	`maš
(
¬gc
 ,*
¬gv
[]) {\

16 
¬gc
 = 1;\

17 
	`debug
("------RUNNING: %s" , 
¬gv
[0]);\

18 
	`´štf
("----\nRUNNING: %s\n" , 
¬gv
[0]);\

19 *
»suÉ
 = 
	`Çme
();\

20 ià(
»suÉ
 != 0) {\

21 
	`´štf
("FAILED: %s\n" , 
»suÉ
);\

24 
	`´štf
("AL TESTS PASSED\n");\

26 
	`´štf
("Te¡ run: %d\n" , 
‹¡s_run
);\

27 
	`ex™
(
»suÉ
 != 0 );\

28 }

	)

30 
	g‹¡s_run
;

	@
1
.
0
7
131
src/lcthw/BSTree.c
src/lcthw/BSTree.h
src/lcthw/bstrlib.c
src/lcthw/bstrlib.h
src/lcthw/dbg.h
tests/BSTree_tests.c
tests/minunit.h
